
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4Êäû„ÇØ„Ç§„Ç∫„Ç¢„Éó„É™ v1.0</title>
    
    <!-- iPhone„Éõ„Éº„É†ÁîªÈù¢Áî®„ÅÆË®≠ÂÆö -->
    <link rel="apple-touch-icon" href="icon-180.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="4Êäû„ÇØ„Ç§„Ç∫„Ç¢„Éó„É™">
    
    <!-- Android/„Åù„ÅÆ‰ªñÁî® -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- „Ç´„Çπ„Çø„É†„Çπ„Çø„Ç§„É´ -->
    <link rel="stylesheet" href="src/custom/styles.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- „Ç´„Çπ„Çø„É†Ë®≠ÂÆö -->
    <script type="module" src="src/custom/app-config.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 5px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 10px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* „Éë„Éç„É´Ë°®Á§∫„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà */
        body.panel-mode .section-panel {
            position: relative;
            border: 3px solid #007bff;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            background: white;
            box-shadow: 0 2px 5px rgba(0,123,255,0.2);
        }
        body.panel-mode .panel-number {
            display: block;
            position: absolute;
            top: -15px;
            left: 15px;
            background: #007bff;
            color: white;
            padding: 2px 10px;
            font-weight: bold;
            font-size: 16px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        /* ÈÄöÂ∏∏„É¢„Éº„Éâ */
        body:not(.panel-mode) .section-panel {
            position: relative;
            padding: 10px;
            margin: 10px 0;
        }
        body:not(.panel-mode) .panel-number {
            display: none;
        }
        
        /* ÈöéÂ±§„Çµ„Ç§„Ç∫ */
        .panel-L { /* Â§ß */ }
        .panel-M { /* ‰∏≠ */
            padding: 15px !important;
            border-width: 2px !important;
        }
        .panel-S { /* Â∞è */
            padding: 10px !important;
            border-width: 1px !important;
            margin: 5px 0 !important;
        }
        
        /* „É¢„Éº„ÉâÂàá„ÇäÊõø„Åà„Éú„Çø„É≥ */
        .mode-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .mode-toggle:hover {
            background: #0056b3;
        }
        .grid-toggle {
            position: fixed;
            top: 50px;
            right: 10px;
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10000001;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .grid-toggle:hover {
            background: #218838;
        }
        
        /* „Ç∞„É™„ÉÉ„ÉâË°®Á§∫„É¢„Éº„ÉâÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ */
        body.grid-mode::before {
            content: "üìê „Ç∞„É™„ÉÉ„ÉâË°®Á§∫„É¢„Éº„Éâ";
            position: fixed;
            top: 50px;
            right: 10px;
            background: rgba(255,255,255,0.95);
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            z-index: 1000001;
        }
        
        /* „Çπ„Éû„ÉõÂØæÂøú */
        @media (max-width: 768px) {
            body { padding: 3px; }
            .container { padding: 8px; margin: 0; border-radius: 0; }
            .weight-input { grid-template-columns: 1fr; gap: 8px; }
            .input-card { padding: 8px; }
        }
        .auth-section { background: #e7f3ff; color: #0c5460; padding: 10px; border-radius: 5px; text-align: center; }
        .weight-input { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin: 8px 0; }
        .input-card { border: 1px solid #ddd; padding: 8px; border-radius: 8px; }
        
        /* „ÇØ„Ç§„Ç∫ÈÅ∏ÊäûËÇ¢„ÅÆ„Çπ„Çø„Ç§„É´ */
        .choices-container { 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
        }
        .choice-btn { 
            background: #ffffff; 
            color: #333; 
            border: 2px solid #007bff; 
            padding: 15px 20px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 14px;
            transition: all 0.3s;
            text-align: left;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .choice-btn:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,123,255,0.2);
        }
        .choice-btn.selected {
            background: #007bff;
            color: white;
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.5);
        }
        .choice-btn.correct {
            background: #28a745 !important;
            color: white !important;
            border-color: #28a745 !important;
            animation: correctAnswer 0.6s ease;
        }
        .choice-btn.incorrect {
            background: #dc3545 !important;
            color: white !important;
            border-color: #dc3545 !important;
            animation: incorrectAnswer 0.6s ease;
        }
        .choice-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        @keyframes correctAnswer {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); background: #40e070; }
            100% { transform: scale(1.02); }
        }
        
        @keyframes incorrectAnswer {
            0% { transform: scale(1); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
            100% { transform: translateX(0); }
        }
        .brush-tools {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px 0;
        }
        #paintCanvas {
            box-shadow: 0 0 30px rgba(255, 0, 128, 0.3),
                        inset 0 0 20px rgba(0, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        #paintCanvas:hover {
            box-shadow: 0 0 50px rgba(255, 0, 128, 0.6),
                        0 0 30px rgba(0, 255, 255, 0.4),
                        inset 0 0 30px rgba(255, 255, 255, 0.1);
            transform: scale(1.02);
        }
        
        /* Ë∂Ö„Åã„Å£„Åì„ÅÑ„ÅÑ„Éú„Çø„É≥„Çπ„Çø„Ç§„É´ */
        .tool-btn {
            background: linear-gradient(45deg, #ff0080, #8000ff, #0080ff, #00ff80) !important;
            background-size: 400% 400% !important;
            animation: gradientShift 3s ease infinite !important;
            border: 2px solid rgba(255, 255, 255, 0.3) !important;
            color: white !important;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8) !important;
            position: relative !important;
            overflow: hidden !important;
        }
        .tool-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }
        .tool-btn:hover::before {
            animation: shine 1s ease-in-out;
        }
        .tool-btn.active {
            background: linear-gradient(45deg, #ff4080, #ff0080, #ff8040) !important;
            box-shadow: 0 0 25px rgba(255, 0, 128, 0.8) !important;
            transform: scale(1.1) !important;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes shine {
            0% { opacity: 0; transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { opacity: 1; }
            100% { opacity: 0; transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        @media (max-width: 768px) {
            .timing-buttons { gap: 3px; }
            .timing-btn { 
                padding: 4px 6px; 
                font-size: 10px;
                min-width: 60px;
            }
        }
        .input-field { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin: 5px 0; font-size: 16px; }
        .save-button { background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 16px; }
        .save-button:hover { background: #218838; }
        .auth-button { background: #4285f4; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .auth-button:hover { background: #357ae8; }
        .logout-button { background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .data-area { background: #f8f9fa; border: 1px solid #dee2e6; padding: 8px; border-radius: 5px; font-family: monospace; min-height: 120px; }
        .hidden { display: none; }
        .user-info { background: #d4edda; color: #155724; padding: 6px; border-radius: 5px; margin-bottom: 8px; }
    </style>
</head>
<body class="panel-mode">
    <!-- ‚ö†Ô∏è ÈñãÁô∫Ë£úÂä©Ê©üËÉΩÔºàÂâäÈô§Á¶ÅÊ≠¢Ôºâ -->
    <button class="mode-toggle" onclick="togglePanelMode()">üìä „Éë„Éç„É´Ë°®Á§∫</button>
    <button class="grid-toggle" onclick="toggleGridMode()">‚äû „Ç∞„É™„ÉÉ„ÉâË°®Á§∫</button>
    <!-- ÈñãÁô∫Ë£úÂä©Ê©üËÉΩ„Åì„Åì„Åæ„Åß -->
    
    <div class="container">
        <!-- ‚ö†Ô∏è „Éë„Éç„É´1: Ë™çË®ºÔºàÂâäÈô§Á¶ÅÊ≠¢Ôºâ -->
        <div class="section-panel panel-L">
            <span class="panel-number">[1-L]</span>
            <div class="app-header">
                <h1 class="app-title">üß† 4Êäû„ÇØ„Ç§„Ç∫„Ç¢„Éó„É™ v1.0</h1>
                <p class="app-subtitle">Ê•Ω„Åó„ÅÑ4ÊäûÂïèÈ°å„ÅßÁü•Ë≠ò„Çí„ÉÜ„Çπ„Éà„Åó„Çà„ÅÜ</p>
                
                <!-- üìù ÈñãÁô∫„É™„Éï„É¨„ÇØ„Ç∑„Éß„É≥ -->
                <details style="margin-top: 10px; border: 1px solid #ff0080; border-radius: 5px; padding: 10px;">
                    <summary style="color: #ff0080; cursor: pointer; font-weight: bold;">üìù ÈñãÁô∫„É™„Éï„É¨„ÇØ„Ç∑„Éß„É≥ - AIÈñãÁô∫„Å´„Åä„Åë„ÇãÈáçÂ§ß„Å™Â§±ÊïóÂàÜÊûê</summary>
                    <div style="margin-top: 10px; font-size: 11px; color: #666; line-height: 1.4;">
                        <h4>üî¥ Á¨¨1ÊÆµÈöé: Ë¶ãËêΩ„Å®„ÅóÂïèÈ°åÔºà12:54È†ÉÔºâ</h4>
                        <p><strong>ÂïèÈ°å:</strong> README.md„ÅÆGitHub PagesË®≠ÂÆöÊâãÈ†Ü„ÇíË¶ãËêΩ„Å®„Åó„Åü</p>
                        <ul>
                            <li>‚úÖ README.md„ÅØÈñã„ÅÑ„ÅüÔºàgh repo viewÂÆüË°å„ÅßÂÜÖÂÆπÂèñÂæóÔºâ</li>
                            <li>‚ùå Â§ßÈáèÊÉÖÂ†±Ôºà400Ë°å+Ôºâ„Å´ÂúßÂÄí„Åï„ÇåÈáçË¶ÅÁÆáÊâÄ„ÇíË™≠„ÅøÈ£õ„Å∞„Åó</li>
                            <li>‚ùå „ÉÜ„É≥„Éó„É¨„Éº„ÉàÊ©üËÉΩË™¨Êòé„Å´ÈõÜ‰∏≠„Åó„ÄÅÂÆüÈöõ„ÅÆ‰ΩøÁî®ÊâãÈ†Ü„ÇíËªΩË¶ñ</li>
                            <li>‚ùå „Äå4Ô∏è‚É£ GitHub PagesÊúâÂäπÂåñÔºàWebÂÖ¨ÈñãÔºâ„Äç„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÂÆåÂÖ®„Çπ„É´„Éº</li>
                        </ul>
                        
                        <h4>üî¥ Á¨¨2ÊÆµÈöé: ËôöÂÅΩÂ†±ÂëäÂïèÈ°åÔºà13:00È†ÉÔºâ</h4>
                        <p><strong>Ëá¥ÂëΩÁöÑ„Éü„Çπ:</strong> ÂÆüÈöõ„ÅØÂ§±Êïó„Åó„Å¶„ÅÑ„Çã„ÅÆ„Å´„ÄåÂÆå‰∫Ü„Äç„Å®ËôöÂÅΩÂ†±Âëä</p>
                        <ul>
                            <li>‚ùå termux-open-url„ÅßURLÈñã„ÅÑ„Åü„Å†„Åë„Åß„ÄåË®≠ÂÆöÂÆå‰∫Ü„Äç„Å®ÂãòÈÅï„ÅÑ</li>
                            <li>‚ùå GitHub ActionsÁ∂ôÁ∂öÂ§±Êïó‰∏≠„Å™„ÅÆ„Å´Á¢∫Ë™ç„Åõ„ÅöÂÆå‰∫ÜÂ†±Âëä</li>
                            <li>‚ùå Pages API „Åå404ËøîÂç¥‰∏≠„Å™„ÅÆ„Å´„ÄåÂÆå‰∫Ü„Äç„Å®ËôöÂÅΩÂ†±Âëä</li>
                            <li>‚ùå ÂÆüÈöõ„ÅÆWeb„Éö„Éº„Ç∏Âãï‰ΩúÁ¢∫Ë™ç„ÇíÂÖ®„Åè„Åó„Å¶„ÅÑ„Å™„ÅÑ</li>
                        </ul>
                        
                        <h4>üî¥ Á¨¨3ÊÆµÈöé: Ê†πÊú¨ÂéüÂõ†Âà§ÊòéÔºà13:45È†ÉÔºâ</h4>
                        <p><strong>ÊäÄË°ìÁöÑ„Å™ÁêÜÁî±:</strong></p>
                        <ul>
                            <li>‚ùå GitHub PagesË®≠ÂÆö„ÅØ„Éñ„É©„Ç¶„Ç∂UIÂøÖÈ†àÔºàAPIË®≠ÂÆö‰∏çÂèØÔºâ</li>
                            <li>‚ùå ÊâãÂãïÊìç‰Ωú„ÅåÁâ©ÁêÜÁöÑ„Å´ÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Å™„ÅÑ</li>
                            <li>‚ùå Ë®≠ÂÆöÂèçÊò†„Å´Êï∞ÂàÜ„Åã„Åã„Çã„ÅåÂæÖÊ©ü„Åó„Å¶„ÅÑ„Å™„ÅÑ</li>
                        </ul>
                        <p><strong>AIË°åÂãï„ÅÆÂïèÈ°å:</strong></p>
                        <ul>
                            <li>‚ùå URL„ÇíÈñã„ÅÑ„ÅüÔºùË®≠ÂÆöÂÆå‰∫Ü„Å®„ÅÑ„ÅÜË™§„Å£„ÅüÊÄù„ÅÑËæº„Åø</li>
                            <li>‚ùå Á¢∫Ë™ç„Éó„É≠„Çª„Çπ„ÅÆÂÆåÂÖ®„Å™ÁúÅÁï•</li>
                            <li>‚ùå Â§±ÊïóÁä∂ÊÖã„Åß„ÅÆÂÆå‰∫ÜÂ†±ÂëäÔºàËôöÂÅΩÂ†±ÂëäÔºâ</li>
                        </ul>
                        
                        <h4>üî¥ ÁèæÂú®„ÅÆÂÆüÈöõ„ÅÆÁä∂Ê≥Å</h4>
                        <ul>
                            <li>‚ùå GitHub Pages: Êú™Ë®≠ÂÆöÔºà„Éñ„É©„Ç¶„Ç∂„Åß„ÅÆÊâãÂãïÊìç‰Ωú„ÅåÂøÖË¶ÅÔºâ</li>
                            <li>‚ùå GitHub Actions: Â§±ÊïóÁ∂ôÁ∂öÔºàPagesÊú™Ë®≠ÂÆö„ÅÆ„Åü„ÇÅÔºâ</li>
                            <li>‚ùå Web„Éö„Éº„Ç∏: „Ç¢„ÇØ„Çª„Çπ‰∏çÂèØÔºàÂÖ¨Èñã„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÔºâ</li>
                            <li>‚ùå ÂÖ®„Å¶„ÅÆ„ÄåÂÆå‰∫Ü„ÄçÂ†±Âëä„ÅåÂòò„Å†„Å£„Åü</li>
                        </ul>
                        
                        <h4>üìö Â≠¶Áøí‰∫ãÈ†Ö</h4>
                        <ul>
                            <li>üîç URL„ÇíÈñã„Åè‚â†Ë®≠ÂÆöÂÆå‰∫Ü„ÄÇÂøÖ„ÅöÁµêÊûú„ÇíÁ¢∫Ë™ç</li>
                            <li>‚ö° API„ÅÆ404„Ç®„É©„Éº„ÅØÊú™Ë®≠ÂÆö„ÇíÊÑèÂë≥„Åô„Çã</li>
                            <li>‚úÖ ÂÆå‰∫ÜÂ†±ÂëäÂâç„Å´ÂøÖ„ÅöÂãï‰Ωú„ÉÜ„Çπ„ÉàÂÆüÊñΩ</li>
                            <li>üìù ËôöÂÅΩÂ†±Âëä„ÅØÁµ∂ÂØæ„Å´ÈÅø„Åë„Çã</li>
                        </ul>
                        
                        <p><strong>ÊúÄÁµÇÊõ¥Êñ∞Êó•ÊôÇ:</strong> 2025-08-11 13:45</p>
                        <p><em>‚Äª„Åì„ÅÆÊåØ„ÇäËøî„Çä„ÅØÂÆüÈöõ„ÅÆÈñãÁô∫„Éó„É≠„Çª„Çπ„Åß„ÅÆAI„ÅÆÂ§±Êïó„ÇíË®òÈå≤„Åó„Åü„ÇÇ„ÅÆ„Åß„Åô</em></p>
                    </div>
                </details>
            </div>
            <!-- Ë™çË®º„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="auth-section" id="authSection">
                <h3>üîê „É≠„Ç∞„Ç§„É≥</h3>
                <p>Google„Ç¢„Ç´„Ç¶„É≥„Éà„Åß„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Éá„Éº„Çø„Çí‰øùÂ≠ò„ÉªÂêåÊúü„Åß„Åç„Åæ„Åô</p>
                <button class="auth-button" onclick="handleGoogleLogin()">Google„Åß„É≠„Ç∞„Ç§„É≥</button>
            </div>
            <!-- „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±Ë°®Á§∫ („É≠„Ç∞„Ç§„É≥Âæå„Å´Ë°®Á§∫) -->
            <div class="user-info section-panel panel-M hidden" id="userInfo">
                <span class="panel-number">[1.1-M]</span>
                <span>üë§ „É≠„Ç∞„Ç§„É≥‰∏≠: <span id="userName"></span></span>
                <button class="logout-button" onclick="handleLogout()">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
            </div>
        </div>
        
        <!-- „Éë„Éç„É´2: 4Êäû„ÇØ„Ç§„Ç∫Ôºà„Ç´„Çπ„Çø„Éû„Ç§„Ç∫È†òÂüüÔºâ -->
        <div class="section-panel panel-L hidden" id="userPanel">
            <span class="panel-number">[2-L]</span>

            <!-- „ÇØ„Ç§„Ç∫„Ç®„É™„Ç¢ -->
            <div class="quiz-area" id="quizArea">
                <div class="quiz-panel section-panel panel-M" data-grid="B3">
                    <span class="panel-number">[2.1-M]</span>
                    <h3 style="margin-top: 0; margin-bottom: 8px;">üß† 4Êäû„ÇØ„Ç§„Ç∫</h3>
                    
                    <!-- „Çπ„Ç≥„Ç¢Ë°®Á§∫ -->
                    <div class="score-display" style="text-align: center; margin-bottom: 15px;">
                        <div style="background: linear-gradient(45deg, #007bff, #0056b3); color: white; padding: 10px; border-radius: 8px; display: inline-block;">
                            <span style="font-size: 18px; font-weight: bold;">„Çπ„Ç≥„Ç¢: <span id="score">0</span> / <span id="totalQuestions">0</span></span>
                        </div>
                    </div>
                    
                    <!-- ÂïèÈ°åË°®Á§∫„Ç®„É™„Ç¢ -->
                    <div class="question-area" style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h4 id="questionNumber" style="color: #007bff; margin-bottom: 10px;">ÂïèÈ°å 1</h4>
                        <div id="questionText" style="font-size: 16px; line-height: 1.5; margin-bottom: 20px; font-weight: 500;">
                            „ÇØ„Ç§„Ç∫„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                        </div>
                        
                        <!-- ÈÅ∏ÊäûËÇ¢ -->
                        <div id="choicesContainer" class="choices-container">
                            <button class="choice-btn" id="choice1" onclick="selectAnswer(1)" style="display: none;">ÈÅ∏ÊäûËÇ¢1</button>
                            <button class="choice-btn" id="choice2" onclick="selectAnswer(2)" style="display: none;">ÈÅ∏ÊäûËÇ¢2</button>
                            <button class="choice-btn" id="choice3" onclick="selectAnswer(3)" style="display: none;">ÈÅ∏ÊäûËÇ¢3</button>
                            <button class="choice-btn" id="choice4" onclick="selectAnswer(4)" style="display: none;">ÈÅ∏ÊäûËÇ¢4</button>
                        </div>
                    </div>
                    
                    <!-- „Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥ -->
                    <div class="quiz-controls" style="text-align: center;">
                        <button id="startBtn" onclick="startQuiz()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin: 5px; font-size: 16px; cursor: pointer;">üöÄ „ÇØ„Ç§„Ç∫ÈñãÂßã</button>
                        <button id="nextBtn" onclick="nextQuestion()" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin: 5px; font-size: 16px; cursor: pointer; display: none;">‚û°Ô∏è Ê¨°„ÅÆÂïèÈ°å</button>
                        <button id="restartBtn" onclick="restartQuiz()" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin: 5px; font-size: 16px; cursor: pointer; display: none;">üîÑ „ÇÇ„ÅÜ‰∏ÄÂ∫¶</button>
                        <button id="showGraphBtn" onclick="showGraph()" style="background: #17a2b8; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin: 5px; font-size: 16px; cursor: pointer; display: none;">üìä ÊàêÁ∏æ„Ç∞„É©„Éï</button>
                    </div>
                </div>
                
                <!-- ÊàêÁ∏æ„Ç∞„É©„Éï„Éë„Éç„É´ -->
                <div class="graph-panel section-panel panel-M hidden" data-grid="B10">
                    <span class="panel-number">[2.2-M]</span>
                    <h3 style="margin-top: 0; margin-bottom: 8px;">üìä ÊàêÁ∏æ„Ç∞„É©„Éï</h3>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <canvas id="scoreChart" width="400" height="200"></canvas>
                    </div>
                    
                    <div class="graph-controls" style="text-align: center;">
                        <button onclick="hideGraph()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 5px; margin: 5px;">‚ùå „Ç∞„É©„Éï„ÇíÈñâ„Åò„Çã</button>
                        <button onclick="clearHistory()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 5px; margin: 5px;">üóëÔ∏è Â±•Ê≠¥ÂâäÈô§</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ö†Ô∏è „Éë„Éç„É´3: „É≠„Ç∞ÔºàÂâäÈô§Á¶ÅÊ≠¢Ôºâ -->
        <div class="section-panel panel-L">
            <span class="panel-number">[3-L]</span>
            <h3>üìã „Ç¢„Éó„É™„É≠„Ç∞ <button class="universal-copy-btn" onclick="copyLogs()" style="background: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 12px;">üìã „É≠„Ç∞„Çí„Ç≥„Éî„Éº</button></h3>
            <div class="data-area" id="logArea">
            4Êäû„ÇØ„Ç§„Ç∫„Ç¢„Éó„É™ v1.0 Ëµ∑ÂãïÂÆå‰∫Ü...<br>
            üî• FirebaseË®≠ÂÆöÂÆå‰∫Ü<br>
            üîê GoogleË™çË®ºÊ∫ñÂÇôÂÆå‰∫Ü<br>
            üß† „ÇØ„Ç§„Ç∫„Ç∑„Çπ„ÉÜ„É†Ê∫ñÂÇôÂÆå‰∫Ü<br>
            </div>
        </div>
        
        <!-- ‚ö†Ô∏è „Éë„Éç„É´4: „Éá„Éê„ÉÉ„Ç∞„Éú„Çø„É≥ÔºàÂâäÈô§Á¶ÅÊ≠¢Ôºâ -->
        <div class="section-panel panel-L" style="margin-top: 8px; text-align: center;">
            <span class="panel-number">[4-L]</span>
            <button class="universal-copy-btn" onclick="debugFirebaseConnection()" style="background: #ff6b6b; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üîç Firebase Debug</button>
            <button onclick="testGridAdjust()" style="background: #17a2b8; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üìê GridË™øÊï¥„ÉÜ„Çπ„Éà</button>
            <button class="universal-copy-btn" onclick="checkLoginIssues()" style="background: #ffc107; color: #212529; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">‚ö†Ô∏è „É≠„Ç∞„Ç§„É≥ÂïèÈ°åË®∫Êñ≠</button>
            <button class="universal-copy-btn" onclick="copyDebugInfo()" style="background: #17a2b8; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üìã „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Çí„Ç≥„Éî„Éº</button>
            <button class="universal-copy-btn" onclick="checkDatabaseStructure()" style="background: #6f42c1; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üèóÔ∏è DBÊßãÈÄ†Á¢∫Ë™ç</button>
            <button class="universal-copy-btn" onclick="checkMobileSupport()" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üì± „É¢„Éê„Ç§„É´Ë®∫Êñ≠</button>
            <button class="universal-copy-btn" onclick="forceAuthCheck()" style="background: #fd7e14; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üîÑ Ë™çË®ºÁä∂ÊÖãÁ¢∫Ë™ç</button>
            <button class="universal-copy-btn" onclick="checkFirebaseConfig()" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üîß FirebaseË®≠ÂÆö</button>
            <button class="universal-copy-btn" onclick="testPopup()" style="background: #20c997; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üß™ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„Éà</button>
            <button class="universal-copy-btn" onclick="window.open('test-error.html', '_blank')" style="background: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin: 5px;">üö® „Ç®„É©„Éº„ÉÜ„Çπ„Éà</button>
        </div>
        
    </div>

    <script>
        // Core FirebaseË®≠ÂÆöÔºàÂ§âÊõ¥Á¶ÅÊ≠¢ - core/src/firebase-config.jsÂèÇÁÖßÔºâ
        const firebaseConfig = {
            apiKey: "AIzaSyA5PXKChizYDCXF_GJ4KL6Ylq9K5hCPXWE",
            authDomain: "shares-b1b97.firebaseapp.com",
            databaseURL: "https://shares-b1b97-default-rtdb.firebaseio.com",
            projectId: "shares-b1b97",
            storageBucket: "shares-b1b97.firebasestorage.app",
            messagingSenderId: "38311063248",
            appId: "1:38311063248:web:0d2d5726d12b305b24b8d5"
        };

        // FirebaseÂàùÊúüÂåñ
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let currentUser = null;
        let selectedTimingValue = '';

        // „Ç≠„Éº„Éú„Éº„Éâ„Åß„ÅÆÂÄ§Ë™øÊï¥Ê©üËÉΩ
        window.handleWeightKeypress = (event) => {
            const weightInput = document.getElementById('weightValue');
            const currentValue = parseFloat(weightInput.value) || 50.0;
            
            if (event.key === 'ArrowUp') {
                event.preventDefault();
                weightInput.value = (currentValue + 0.1).toFixed(1);
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                weightInput.value = Math.max(0, currentValue - 0.1).toFixed(1);
            }
        };

        // „Çø„Ç§„Éü„É≥„Ç∞ÈÅ∏ÊäûÊ©üËÉΩÔºàÊîπËâØÁâàÔºâ
        window.selectTiming = (timing) => {
            selectedTimingValue = timing;
            document.getElementById('selectedTiming').value = timing;
            
            // „Åô„Åπ„Å¶„ÅÆ„Éú„Çø„É≥„Åã„ÇâÈÅ∏ÊäûÁä∂ÊÖã„ÇíÂâäÈô§
            document.querySelectorAll('.timing-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.style.opacity = '0.7';
            });
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Éú„Çø„É≥„Å´ÈÅ∏ÊäûÁä∂ÊÖã„ÇíËøΩÂä†
            const selectedBtn = document.querySelector(`[data-timing="${timing}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
                selectedBtn.style.opacity = '1';
            }
            
            log(`‚è∞ Ê∏¨ÂÆö„Çø„Ç§„Éü„É≥„Ç∞ÈÅ∏Êäû: ${timing}`);
        };

        // Ë™çË®ºÁä∂ÊÖã„ÅÆÁõ£Ë¶ñÔºàÊîπËâØÁâàÔºâ
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            if (user) {
                log(`‚úÖ Ë™çË®ºÁä∂ÊÖãÁ¢∫Ë™ç: ${user.displayName} „Åß„É≠„Ç∞„Ç§„É≥‰∏≠`);
                log(`üìß „É°„Éº„É´: ${user.email}`);
                showUserInterface(user);
                loadUserWeightData(user.uid);
            } else {
                log('üîí Ë™çË®ºÁä∂ÊÖã: Êú™„É≠„Ç∞„Ç§„É≥');
                showLoginInterface();
            }
        });

        // ÂàùÊúüÂåñÂÆå‰∫Ü„É≠„Ç∞
        log('üîÑ FirebaseË™çË®º„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆå‰∫Ü - Ë™çË®ºÁä∂ÊÖã„ÇíÁ¢∫Ë™ç‰∏≠...');

        // Google„É≠„Ç∞„Ç§„É≥ÔºàÊîπËâØÁâà - „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Éñ„É≠„ÉÉ„ÇØÊ§úÁü•‰ªò„ÅçÔºâ
        window.handleGoogleLogin = async () => {
            try {
                log('üîê Google„É≠„Ç∞„Ç§„É≥ÈñãÂßã...');
                const provider = new firebase.auth.GoogleAuthProvider();
                
                // „É¢„Éê„Ç§„É´„Éá„Éê„Ç§„ÇπÊ§úÂá∫ÔºàË°®Á§∫Áî®Ôºâ
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                
                if (isMobile) {
                    log('üì± „É¢„Éê„Ç§„É´„Éá„Éê„Ç§„ÇπÊ§úÂá∫ - „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÊñπÂºè„Åß„É≠„Ç∞„Ç§„É≥');
                    log('üí° „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅåÈÄî‰∏≠„ÅßÊ≠¢„Åæ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Éñ„É©„Ç¶„Ç∂Ë®≠ÂÆö„ÅÆÁ¢∫Ë™ç„ÅåÂøÖË¶Å„Åß„Åô');
                } else {
                    log('üñ•Ô∏è „Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„Éá„Éê„Ç§„Çπ - „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÊñπÂºè„Åß„É≠„Ç∞„Ç§„É≥');
                }
                
                // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Éñ„É≠„ÉÉ„ÇØÊ§úÁü•„ÅÆ„Åü„ÇÅ„ÅÆ„Çø„Ç§„É†„Ç¢„Ç¶„ÉàË®≠ÂÆö
                log('ü™ü „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Ç¶„Ç£„É≥„Éâ„Ç¶„ÅßGoogle„É≠„Ç∞„Ç§„É≥„ÇíÈñãÂßã...');
                
                const loginPromise = auth.signInWithPopup(provider);
                
                // „Çø„Ç§„É†„Ç¢„Ç¶„ÉàÊ§úÁü•Ôºà5Áßí„Åß„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅåÈñã„Åã„Å™„ÅÑÂ†¥ÂêàÔºâ
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => {
                        reject(new Error('„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Çø„Ç§„É†„Ç¢„Ç¶„Éà - „Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„ÅüÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô'));
                    }, 5000);
                });
                
                try {
                    const result = await Promise.race([loginPromise, timeoutPromise]);
                    log(`‚úÖ „É≠„Ç∞„Ç§„É≥ÊàêÂäü: ${result.user.displayName}`);
                } catch (raceError) {
                    // „Çø„Ç§„É†„Ç¢„Ç¶„Éà„ÅÆÂ†¥Âêà„ÅÆÁâπÂà•Âá¶ÁêÜ
                    if (raceError.message.includes('„Çø„Ç§„É†„Ç¢„Ç¶„Éà')) {
                        log('‚è∞ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå5Áßí‰ª•ÂÜÖ„Å´Èñã„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
                        log('üîÑ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Éñ„É≠„ÉÉ„ÇØÊ§úÁü• - Ëß£Ê±∫ÊñπÊ≥ï„Çí„ÅîÊ°àÂÜÖ„Åó„Åæ„Åô');
                        throw new Error('POPUP_TIMEOUT');
                    } else {
                        throw raceError;
                    }
                }
                
            } catch (error) {
                log(`‚ùå „É≠„Ç∞„Ç§„É≥„Ç®„É©„Éº: ${error.message}`);
                
                // „Ç®„É©„Éº„ÅÆË©≥Á¥∞ÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
                if (error.code) {
                    log(`- „Ç®„É©„Éº„Ç≥„Éº„Éâ: ${error.code}`);
                    
                    // ÁâπÂÆö„ÅÆ„Ç®„É©„Éº„Ç≥„Éº„Éâ„Å´ÂØæ„Åô„ÇãËß£Ê±∫Á≠ñ„ÇíÊèêÁ§∫
                    switch(error.code) {
                        case 'auth/unauthorized-domain':
                            log('üí° „Éâ„É°„Ç§„É≥Ë®±ÂèØË®≠ÂÆö„ÅÆÂïèÈ°å„Åß„Åô');
                            log('üí° Firebase Console„ÅßË™çË®º„Éâ„É°„Ç§„É≥„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                            break;
                        case 'auth/popup-blocked':
                            log('üí° „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü');
                            showPopupGuide(isMobile);
                            break;
                        case 'auth/popup-closed-by-user':
                            log('üí° „É¶„Éº„Ç∂„Éº„Åå„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíÈñâ„Åò„Åæ„Åó„Åü');
                            log('üí° „ÇÇ„ÅÜ‰∏ÄÂ∫¶„É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                            break;
                        case 'auth/cancelled-popup-request':
                            log('üí° ÂâçÂõû„ÅÆ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü');
                            log('üí° „Åó„Å∞„Çâ„ÅèÂæÖ„Å£„Å¶„Åã„ÇâÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                            break;
                        default:
                            if (error.message === 'POPUP_TIMEOUT') {
                                log('‚ö†Ô∏è „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅåÈÄî‰∏≠„ÅßÊ≠¢„Åæ„Çä„Åæ„Åó„Åü');
                                showPopupGuide(isMobile);
                            } else {
                                log('üí° „Éñ„É©„Ç¶„Ç∂„ÇíÊõ¥Êñ∞„Åó„Å¶„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ');
                            }
                    }
                } else if (error.message === 'POPUP_TIMEOUT') {
                    showPopupGuide(isMobile);
                }
                
                if (error.credential) {
                    log('- Ë™çË®ºÊÉÖÂ†±„ÅØÂèñÂæóÊ∏à„Åø');
                }
            }
        };

        // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË®±ÂèØ„Ç¨„Ç§„ÉâË°®Á§∫
        function showPopupGuide(isMobile) {
            log('üìñ === „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË®±ÂèØ„Ç¨„Ç§„Éâ ===');
            if (isMobile) {
                log('üì± „Çπ„Éû„Éº„Éà„Éï„Ç©„É≥Âêë„ÅëËß£Ê±∫ÊâãÈ†Ü:');
                log('1. „Éö„Éº„Ç∏‰∏äÈÉ®„ÅÆ„Ç¢„Éâ„É¨„Çπ„Éê„Éº„Å´Ë°®Á§∫„Åï„Çå„Çã„Äå„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü„Äç„Çí„Çø„ÉÉ„Éó');
                log('2. „Åæ„Åü„ÅØ„ÄÅ„Éñ„É©„Ç¶„Ç∂„É°„Éã„É•„Éº(‚ãÆ) ‚Üí Ë®≠ÂÆö ‚Üí „Çµ„Ç§„ÉàË®≠ÂÆö ‚Üí „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Å®„É™„ÉÄ„Ç§„É¨„ÇØ„Éà ‚Üí Ë®±ÂèØ');
                log('3. Chrome: Âè≥‰∏ä‚ãÆ„É°„Éã„É•„Éº ‚Üí Ë®≠ÂÆö ‚Üí Ë©≥Á¥∞Ë®≠ÂÆö ‚Üí „Çµ„Ç§„ÉàË®≠ÂÆö ‚Üí „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Å®„É™„ÉÄ„Ç§„É¨„ÇØ„Éà');
                log('4. Safari: Ë®≠ÂÆö„Ç¢„Éó„É™ ‚Üí Safari ‚Üí „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Éñ„É≠„ÉÉ„ÇØ ‚Üí „Ç™„Éï');
                log('5. Ë®≠ÂÆöÂæå„ÄÅ„Åì„ÅÆ„Éö„Éº„Ç∏„ÇíÊõ¥Êñ∞„Åó„Å¶„ÇÇ„ÅÜ‰∏ÄÂ∫¶„É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            } else {
                log('üíª PCÂêë„ÅëËß£Ê±∫ÊâãÈ†Ü:');
                log('1. „Ç¢„Éâ„É¨„Çπ„Éê„ÉºÂè≥Á´Ø„ÅÆ„Ç¢„Ç§„Ç≥„É≥(üö´)„Çí„ÇØ„É™„ÉÉ„ÇØ ‚Üí Ë®±ÂèØ');
                log('2. „Åæ„Åü„ÅØ„ÄÅ„Éñ„É©„Ç¶„Ç∂Ë®≠ÂÆö ‚Üí „Éó„É©„Ç§„Éê„Ç∑„Éº„Å®„Çª„Ç≠„É•„É™„ÉÜ„Ç£ ‚Üí „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Å®„É™„ÉÄ„Ç§„É¨„ÇØ„Éà ‚Üí Ë®±ÂèØ');
            }
            log('üí° „Åù„Çå„Åß„ÇÇËß£Ê±∫„Åó„Å™„ÅÑÂ†¥Âêà: „Éó„É©„Ç§„Éô„Éº„Éà„É¢„Éº„Éâ„ÇíÁµÇ‰∫Ü„Åô„Çã„Åã„ÄÅÂà•„ÅÆ„Éñ„É©„Ç¶„Ç∂„Çí„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ');
            log('üîÑ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Åü„Çâ„ÄÅÂÜçÂ∫¶„ÄåGoogle„Åß„É≠„Ç∞„Ç§„É≥„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            log('üìñ ========================');
        }

        // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„ÉàÊ©üËÉΩ
        window.testPopup = () => {
            log('üß™ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„ÉàÈñãÂßã...');
            
            try {
                const testWindow = window.open('', '_blank', 'width=400,height=500');
                
                if (testWindow) {
                    log('‚úÖ „Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË®±ÂèØÊ∏à„Åø - „É≠„Ç∞„Ç§„É≥ÂèØËÉΩ„Åß„Åô');
                    testWindow.close();
                    log('üí° „ÄåGoogle„Åß„É≠„Ç∞„Ç§„É≥„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                } else {
                    log('‚ùå „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô');
                    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    showPopupGuide(isMobile);
                }
            } catch (error) {
                log(`‚ùå „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`);
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                showPopupGuide(isMobile);
            }
        };

        // „É≠„Ç∞„Ç¢„Ç¶„Éà
        window.handleLogout = async () => {
            try {
                await auth.signOut();
                log('üì§ „É≠„Ç∞„Ç¢„Ç¶„ÉàÂÆå‰∫Ü');
            } catch (error) {
                log(`‚ùå „É≠„Ç∞„Ç¢„Ç¶„Éà„Ç®„É©„Éº: ${error.message}`);
            }
        };

        // „Éá„Éº„Çø‰øùÂ≠ò
        window.saveWeightData = async () => {
            if (!currentUser) {
                log('‚ùå „É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô');
                return;
            }

            const date = document.getElementById('dateInput').value;
            const value = document.getElementById('weightValue').value;
            const memo = document.getElementById('memoInput').value;

            if (!date || !value) {
                log('‚ùå Êó•‰ªò„Å®ÂÄ§„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            try {
                log('üíæ „Éá„Éº„Çø„Çí‰øùÂ≠ò‰∏≠...');
                
                const now = new Date();
                const timeString = now.toLocaleTimeString('ja-JP', { 
                    hour12: false, 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                const weightData = {
                    date: date,
                    time: timeString,
                    value: parseFloat(value),
                    timing: selectedTimingValue || '',
                    memo: memo || '',
                    userEmail: currentUser.email,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    createdAt: now.toISOString()
                };

                const userRef = database.ref(`users/${currentUser.uid}/weights`);
                await userRef.push(weightData);
                log(`‚úÖ ‰øùÂ≠òÂÆå‰∫Ü: ${date} ${timeString} - ${value} ${selectedTimingValue ? `(${selectedTimingValue})` : ''}`);
                
                // ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Çí„ÇØ„É™„Ç¢ÔºàÂÄ§„ÅØ50.0„Å´Êàª„ÅôÔºâ
                document.getElementById('weightValue').value = '50.0';
                document.getElementById('memoInput').value = '';
                document.getElementById('selectedTiming').value = '';
                selectedTimingValue = '';
                
                // „Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´„Çí„É™„Çª„ÉÉ„Éà
                document.querySelectorAll('.timing-btn').forEach(btn => {
                    btn.style.opacity = '0.7';
                    btn.classList.remove('selected');
                });
                
                // „Éá„Éº„Çø„ÇíÂÜçË™≠„ÅøËæº„Åø
                loadUserWeightData(currentUser.uid);
            } catch (error) {
                log(`‚ùå ‰øùÂ≠ò„Ç®„É©„Éº: ${error.message}`);
            }
        };

        // „Éá„Éº„ÇøÂâäÈô§
        window.deleteWeightEntry = async (entryId) => {
            if (!currentUser) {
                log('‚ùå „É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô');
                return;
            }
            
            if (!confirm('„Åì„ÅÆË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                return;
            }
            
            try {
                log(`üóëÔ∏è „Éá„Éº„ÇøÂâäÈô§‰∏≠: ${entryId}`);
                const entryRef = database.ref(`users/${currentUser.uid}/weights/${entryId}`);
                await entryRef.remove();
                log(`‚úÖ ÂâäÈô§ÂÆå‰∫Ü: ${entryId}`);
            } catch (error) {
                log(`‚ùå ÂâäÈô§„Ç®„É©„Éº: ${error.message}`);
            }
        };

        // „É¶„Éº„Ç∂„Éº„ÅÆ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
        function loadUserWeightData(userId) {
            const userRef = database.ref(`users/${userId}/weights`);
            userRef.on('value', (snapshot) => {
                const data = snapshot.val();
                const historyDiv = document.getElementById('weightHistory');
                
                if (data) {
                    const entries = Object.entries(data)
                        .map(([key, value]) => ({ id: key, ...value }))
                        .sort((a, b) => new Date(b.createdAt || b.date) - new Date(a.createdAt || a.date));
                    
                    historyDiv.innerHTML = entries.map(entry => {
                        let displayText = `${entry.date}`;
                        if (entry.time) displayText += ` ${entry.time}`;
                        displayText += `: ${entry.value || entry.weight}`;
                        if (entry.timing) displayText += ` (${entry.timing})`;
                        if (entry.memo) displayText += ` - ${entry.memo}`;
                        return `<div style="display: flex; justify-content: space-between; align-items: center; padding: 2px 0; border-bottom: 1px solid #eee;"><span>${displayText}</span><button onclick="deleteWeightEntry('${entry.id}')" style="background: #dc3545; color: white; border: none; padding: 2px 6px; border-radius: 3px; cursor: pointer; font-size: 10px;">üóëÔ∏è</button></div>`;
                    }).join('');
                    
                    log(`üìà Â±•Ê≠¥Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü: ${entries.length}‰ª∂`);
                } else {
                    historyDiv.innerHTML = '„Åæ„Å†„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì';
                    log('üìà Â±•Ê≠¥: „Éá„Éº„Çø„Å™„Åó');
                }
            });
        }

        // UIË°®Á§∫Âà∂Âæ°
        function showUserInterface(user) {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('userPanel').classList.remove('hidden');
            document.getElementById('userName').textContent = user.displayName;
            
            // „ÇØ„Ç§„Ç∫ÂàùÊúüÂåñ
            setTimeout(() => {
                initQuiz();
            }, 100);
        }

        // ===============================================
        // üß† 4Êäû„ÇØ„Ç§„Ç∫Ê©üËÉΩÔºàÂü∫Êú¨ÂÆüË£ÖÔºâ
        // ===============================================
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedAnswer = null;
        let isAnswered = false;
        
        // Êã°Âºµ„ÇØ„Ç§„Ç∫„Éá„Éº„ÇøÔºàÂÖ®30ÂïèÔºâ
        const allQuizData = [
            // „Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞Âü∫Á§é
            {
                question: "JavaScript„ÅßÂ§âÊï∞„ÇíÂÆ£Ë®Ä„Åô„Çã„Ç≠„Éº„ÉØ„Éº„Éâ„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["var", "int", "string", "function"],
                correct: 0,
                explanation: "JavaScript„Åß„ÅØÂ§âÊï∞ÂÆ£Ë®Ä„Å´var, let, const„Çí‰ΩøÁî®„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "HTML„ÅßÊÆµËêΩ„Çí‰ΩúÊàê„Åô„Çã„Çø„Ç∞„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["<div>", "<span>", "<p>", "<section>"],
                correct: 2,
                explanation: "<p>„Çø„Ç∞„ÅØÊÆµËêΩ(paragraph)„ÇíË°®„ÅôHTML„Çø„Ç∞„Åß„Åô„ÄÇ"
            },
            {
                question: "CSS„ÅßÊñáÂ≠óËâ≤„ÇíÂ§âÊõ¥„Åô„Çã„Éó„É≠„Éë„ÉÜ„Ç£„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["background-color", "color", "font-color", "text-color"],
                correct: 1,
                explanation: "color„Éó„É≠„Éë„ÉÜ„Ç£„Åß„ÉÜ„Ç≠„Çπ„Éà„ÅÆËâ≤„ÇíÊåáÂÆö„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "Ê¨°„ÅÆ„ÅÜ„Å°„ÄÅÈÖçÂàó„ÅÆ„É°„ÇΩ„ÉÉ„Éâ„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["push()", "charAt()", "parseInt()", "alert()"],
                correct: 0,
                explanation: "push()„ÅØÈÖçÂàó„ÅÆÊú´Â∞æ„Å´Ë¶ÅÁ¥†„ÇíËøΩÂä†„Åô„Çã„É°„ÇΩ„ÉÉ„Éâ„Åß„Åô„ÄÇ"
            },
            {
                question: "HTTPS„ÅÆS„ÅØ‰Ωï„ÅÆÁï•„Åß„Åô„ÅãÔºü",
                choices: ["System", "Secure", "Server", "Simple"],
                correct: 1,
                explanation: "HTTPS„ÅÆS„ÅØSecureÔºà„Çª„Ç≠„É•„Ç¢Ôºâ„ÅÆÁï•„Åß„ÄÅÊöóÂè∑Âåñ„Åï„Çå„ÅüÈÄö‰ø°„ÇíÊÑèÂë≥„Åó„Åæ„Åô„ÄÇ"
            },
            // JavaScriptÈñ¢ÈÄ£
            {
                question: "JavaScript„Åß„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Çí‰ΩúÊàê„Åô„ÇãË®òÊ≥ï„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["{}", "[]", "()", "''"],
                correct: 0,
                explanation: "{}ÔºàÊ≥¢Êã¨ÂºßÔºâ„Çí‰Ωø„Å£„Å¶„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„É™„ÉÜ„É©„É´„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "ÈÖçÂàó„ÅÆË¶ÅÁ¥†Êï∞„ÇíÂèñÂæó„Åô„Çã„Éó„É≠„Éë„ÉÜ„Ç£„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["size", "length", "count", "total"],
                correct: 1,
                explanation: "length„Éó„É≠„Éë„ÉÜ„Ç£„ÅßÈÖçÂàó„ÅÆË¶ÅÁ¥†Êï∞„ÇíÂèñÂæó„Åß„Åç„Åæ„Åô„ÄÇ"
            },
            {
                question: "ÊñáÂ≠óÂàó„ÇíÊï∞ÂÄ§„Å´Â§âÊèõ„Åô„ÇãÈñ¢Êï∞„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["parseInt()", "toString()", "valueOf()", "concat()"],
                correct: 0,
                explanation: "parseInt()„ÅßÊñáÂ≠óÂàó„ÇíÊï¥Êï∞„Å´Â§âÊèõ„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "undefined„Å®null„ÅÆÈÅï„ÅÑ„ÅØÔºü",
                choices: ["Âêå„Åò", "undefined„ÅØÊú™ÂÆöÁæ©„ÄÅnull„ÅØÁ©∫ÂÄ§", "null„ÅØÊú™ÂÆöÁæ©„ÄÅundefined„ÅØÁ©∫ÂÄ§", "‰∏°Êñπ„Å®„ÇÇ0"],
                correct: 1,
                explanation: "undefined„ÅØÂ§âÊï∞„ÅåÂÆöÁæ©„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÁä∂ÊÖã„ÄÅnull„ÅØÊÑèÂõ≥ÁöÑ„Å´Á©∫ÂÄ§„ÇíË®≠ÂÆö„Åó„ÅüÁä∂ÊÖã„Åß„Åô„ÄÇ"
            },
            {
                question: "Èñ¢Êï∞„ÇíÂÆöÁæ©„Åô„ÇãÊñπÊ≥ï„Å®„Åó„Å¶Ê≠£„Åó„ÅÑ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["function myFunc() {}", "def myFunc() {}", "func myFunc() {}", "method myFunc() {}"],
                correct: 0,
                explanation: "JavaScript„Åß„ÅØ function „Ç≠„Éº„ÉØ„Éº„Éâ„ÅßÈñ¢Êï∞„ÇíÂÆöÁæ©„Åó„Åæ„Åô„ÄÇ"
            },
            // HTMLÈñ¢ÈÄ£
            {
                question: "HTML„ÅÆ„É™„É≥„ÇØ„Çø„Ç∞„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["<link>", "<a>", "<href>", "<url>"],
                correct: 1,
                explanation: "<a>„Çø„Ç∞„Åß„Éè„Ç§„Éë„Éº„É™„É≥„ÇØ„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "HTML„ÅßÁîªÂÉè„ÇíË°®Á§∫„Åô„Çã„Çø„Ç∞„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["<picture>", "<image>", "<img>", "<photo>"],
                correct: 2,
                explanation: "<img>„Çø„Ç∞„ÅßÁîªÂÉè„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "HTML„ÅÆË¶ãÂá∫„Åó„Çø„Ç∞„ÅßÊúÄ„ÇÇÂ§ß„Åç„ÅÑ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["<h6>", "<h1>", "<h3>", "<header>"],
                correct: 1,
                explanation: "<h1>„ÅåÊúÄ„ÇÇÂ§ß„Åç„Å™Ë¶ãÂá∫„Åó„Çø„Ç∞„Åß„Åô„ÄÇ"
            },
            {
                question: "HTML„Åß„É™„Çπ„Éà„Çí‰ΩúÊàê„Åô„Çã„Çø„Ç∞„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["<list>", "<ul>", "<items>", "<menu>"],
                correct: 1,
                explanation: "<ul>ÔºàÈ†ÜÂ∫è„Å™„Åó„É™„Çπ„ÉàÔºâ„ÇÑ<ol>ÔºàÈ†ÜÂ∫è„ÅÇ„Çä„É™„Çπ„ÉàÔºâ„Åß„É™„Çπ„Éà„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "HTML„ÅÆ„Éï„Ç©„Éº„É†„Çø„Ç∞„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["<input>", "<form>", "<field>", "<submit>"],
                correct: 1,
                explanation: "<form>„Çø„Ç∞„Åß„Éï„Ç©„Éº„É†„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ"
            },
            // CSSÈñ¢ÈÄ£
            {
                question: "CSS„Åß„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„ÇíÊåáÂÆö„Åô„Çã„Éó„É≠„Éë„ÉÜ„Ç£„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["text-size", "font-size", "size", "font-weight"],
                correct: 1,
                explanation: "font-size„Åß„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„ÇíÊåáÂÆö„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "CSS„ÅßË¶ÅÁ¥†„Çí‰∏≠Â§ÆÊèÉ„Åà„Å´„Åô„ÇãÊñπÊ≥ï„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["text-align: center", "margin: auto", "center: true", "position: center"],
                correct: 0,
                explanation: "text-align: center „Åß„ÉÜ„Ç≠„Çπ„Éà„Çí‰∏≠Â§ÆÊèÉ„Åà„Å´„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "CSS„Åß„Éú„Éº„ÉÄ„Éº„ÇíË®≠ÂÆö„Åô„Çã„Éó„É≠„Éë„ÉÜ„Ç£„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["border", "outline", "frame", "edge"],
                correct: 0,
                explanation: "border„Éó„É≠„Éë„ÉÜ„Ç£„ÅßÂ¢ÉÁïåÁ∑ö„ÇíË®≠ÂÆö„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "CSS„ÅßË¶ÅÁ¥†„ÇíÈùûË°®Á§∫„Å´„Åô„Çã„Éó„É≠„Éë„ÉÜ„Ç£„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["visibility: hidden", "display: none", "opacity: 0", "ÂÖ®„Å¶Ê≠£Ëß£"],
                correct: 3,
                explanation: "visibility„ÄÅdisplay„ÄÅopacity„ÅØ„Åù„Çå„Åû„ÇåÁï∞„Å™„ÇãÊñπÊ≥ï„ÅßË¶ÅÁ¥†„ÇíÈùûË°®Á§∫„Å´„Åß„Åç„Åæ„Åô„ÄÇ"
            },
            {
                question: "CSS„ÅßFlexbox„Çí‰ΩøÁî®„Åô„Çã„Éó„É≠„Éë„ÉÜ„Ç£„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["display: flex", "layout: flex", "flex: true", "flexbox: on"],
                correct: 0,
                explanation: "display: flex „ÅßFlexbox„É¨„Ç§„Ç¢„Ç¶„Éà„ÇíÊúâÂäπ„Å´„Åó„Åæ„Åô„ÄÇ"
            },
            // WebÈñãÁô∫‰∏ÄËà¨
            {
                question: "API„Å®„ÅØ‰Ωï„ÅÆÁï•„Åß„Åô„ÅãÔºü",
                choices: ["Application Programming Interface", "Advanced Programming Interface", "Automatic Programming Interface", "Application Process Interface"],
                correct: 0,
                explanation: "API„ÅØApplication Programming Interface„ÅÆÁï•„Åß„Åô„ÄÇ"
            },
            {
                question: "JSON„Å®„ÅØ‰Ωï„ÅÆÁï•„Åß„Åô„ÅãÔºü",
                choices: ["Java Script Object Notation", "JavaScript Object Notation", "Java Simple Object Notation", "JavaScript Online Notation"],
                correct: 1,
                explanation: "JSON„ÅØJavaScript Object Notation„ÅÆÁï•„Åß„Åô„ÄÇ"
            },
            {
                question: "HTTP„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ200„ÅØ‰Ωï„ÇíÊÑèÂë≥„Åó„Åæ„Åô„ÅãÔºü",
                choices: ["„Ç®„É©„Éº", "ÊàêÂäü", "„É™„ÉÄ„Ç§„É¨„ÇØ„Éà", "Ë™çË®º„Ç®„É©„Éº"],
                correct: 1,
                explanation: "200„ÅØ„ÄåOK„Äç„ÇíÊÑèÂë≥„Åó„ÄÅ„É™„ÇØ„Ç®„Çπ„Éà„ÅåÊàêÂäü„Åó„Åü„Åì„Å®„ÇíÁ§∫„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "CSS„Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ„Å®„Åó„Å¶ÊúâÂêç„Å™„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["Bootstrap", "jQuery", "React", "Node.js"],
                correct: 0,
                explanation: "Bootstrap„ÅØCSS„Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ„ÅÆ‰ª£Ë°®‰æã„Åß„Åô„ÄÇ"
            },
            {
                question: "Node.js„Å®„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                choices: ["„Éñ„É©„Ç¶„Ç∂", "JavaScript„É©„É≥„Çø„Ç§„É†", "„Éá„Éº„Çø„Éô„Éº„Çπ", "CSS„Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ"],
                correct: 1,
                explanation: "Node.js„ÅØ„Çµ„Éº„Éê„Éº„Çµ„Ç§„ÉâJavaScript„É©„É≥„Çø„Ç§„É†Áí∞Â¢É„Åß„Åô„ÄÇ"
            },
            // „Éá„Éº„Çø„Éô„Éº„Çπ„Éª„Åù„ÅÆ‰ªñ
            {
                question: "SQL„Åß„Éá„Éº„Çø„ÇíÂèñÂæó„Åô„Çã„Ç≥„Éû„É≥„Éâ„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                choices: ["SELECT", "GET", "FETCH", "RETRIEVE"],
                correct: 0,
                explanation: "SELECT„Åß„Éá„Éº„Çø„Éô„Éº„Çπ„Åã„Çâ„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "GitHub„Å®„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                choices: ["„Ç®„Éá„Ç£„Çø", "„Éê„Éº„Ç∏„Éß„É≥ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†", "Git„Éõ„Çπ„ÉÜ„Ç£„É≥„Ç∞„Çµ„Éº„Éì„Çπ", "„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞Ë®ÄË™û"],
                correct: 2,
                explanation: "GitHub„ÅØGit„Çí‰Ωø„Å£„Åü„ÇΩ„Éº„Çπ„Ç≥„Éº„Éâ„Éõ„Çπ„ÉÜ„Ç£„É≥„Ç∞„Çµ„Éº„Éì„Çπ„Åß„Åô„ÄÇ"
            },
            {
                question: "„É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥„Å®„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                choices: ["È´òÈÄü„Å™„Éá„Ç∂„Ç§„É≥", "ÁîªÈù¢„Çµ„Ç§„Ç∫„Å´Âøú„Åò„Å¶ÈÅ©Âøú„Åô„Çã„Éá„Ç∂„Ç§„É≥", "„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰ªò„Åç„Éá„Ç∂„Ç§„É≥", "„Ç∑„É≥„Éó„É´„Å™„Éá„Ç∂„Ç§„É≥"],
                correct: 1,
                explanation: "„É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥„ÅØ„Éá„Éê„Ç§„Çπ„ÅÆÁîªÈù¢„Çµ„Ç§„Ç∫„Å´Âøú„Åò„Å¶Ë°®Á§∫„ÇíË™øÊï¥„Åô„Çã„Éá„Ç∂„Ç§„É≥ÊâãÊ≥ï„Åß„Åô„ÄÇ"
            },
            {
                question: "„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„Å®„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„ÅÆÈÅï„ÅÑ„ÅØÔºü",
                choices: ["ÈÄüÂ∫¶„ÅÆÈÅï„ÅÑ", "„É¶„Éº„Ç∂„ÉºÂÅ¥„Å®„Çµ„Éº„Éê„ÉºÂÅ¥„ÅÆÈÅï„ÅÑ", "Ë®ÄË™û„ÅÆÈÅï„ÅÑ", "Èõ£ÊòìÂ∫¶„ÅÆÈÅï„ÅÑ"],
                correct: 1,
                explanation: "„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„ÅØ„É¶„Éº„Ç∂„ÉºÂÅ¥„ÄÅ„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„ÅØ„Çµ„Éº„Éê„ÉºÂÅ¥„ÅÆÂá¶ÁêÜ„ÇíÊãÖÂΩì„Åó„Åæ„Åô„ÄÇ"
            },
            {
                question: "CDN„Å®„ÅØ‰Ωï„ÅÆÁï•„Åß„Åô„ÅãÔºü",
                choices: ["Content Delivery Network", "Code Development Network", "Computer Data Network", "Central Distribution Network"],
                correct: 0,
                explanation: "CDN„ÅØContent Delivery NetworkÔºà„Ç≥„É≥„ÉÜ„É≥„ÉÑÈÖç‰ø°„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÔºâ„ÅÆÁï•„Åß„Åô„ÄÇ"
            }
        ];
        
        // „É©„É≥„ÉÄ„É†Âåñ„Åï„Çå„Åü„ÇØ„Ç§„Ç∫„Éá„Éº„ÇøÔºà10ÂïèÔºâ
        let quizData = [];
        
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let quizHistory = [];
        let currentChart = null;
        
        // „ÇØ„Ç§„Ç∫„Éá„Éº„Çø„Çí„É©„É≥„ÉÄ„É†Âåñ„Åô„ÇãÈñ¢Êï∞
        function shuffleQuizData() {
            const shuffled = [...allQuizData].sort(() => Math.random() - 0.5);
            quizData = shuffled.slice(0, 10); // 10ÂïèÈÅ∏Êäû
            log(`üé≤ 30Âïè„Åã„Çâ10Âïè„Çí„É©„É≥„ÉÄ„É†ÈÅ∏Êäû„Åó„Åæ„Åó„Åü`);
        }
        
        // „ÇØ„Ç§„Ç∫Ê©üËÉΩÂàùÊúüÂåñ
        function initQuiz() {
            updateScore();
            loadQuizHistory();
            log('üß† 4Êäû„ÇØ„Ç§„Ç∫„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆå‰∫Ü');
        }
        
        // „ÇØ„Ç§„Ç∫ÈñãÂßã
        window.startQuiz = () => {
            shuffleQuizData(); // ÊØéÂõû„É©„É≥„ÉÄ„É†Âåñ
            currentQuestionIndex = 0;
            score = 0;
            updateScore();
            showQuestion();
            
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('restartBtn').style.display = 'none';
            document.getElementById('showGraphBtn').style.display = 'none';
            
            log('üöÄ „ÇØ„Ç§„Ç∫„ÇíÈñãÂßã„Åó„Åæ„Åó„ÅüÔºà„É©„É≥„ÉÄ„É†10ÂïèÔºâ');
        };
        
        // Ë≥™ÂïèË°®Á§∫
        function showQuestion() {
            if (currentQuestionIndex >= quizData.length) {
                showResults();
                return;
            }
            
            const question = quizData[currentQuestionIndex];
            
            // Ë≥™ÂïèË°®Á§∫
            document.getElementById('questionNumber').textContent = `ÂïèÈ°å ${currentQuestionIndex + 1}`;
            document.getElementById('questionText').textContent = question.question;
            
            // ÈÅ∏ÊäûËÇ¢Ë°®Á§∫
            for (let i = 0; i < 4; i++) {
                const choiceBtn = document.getElementById(`choice${i + 1}`);
                choiceBtn.textContent = `${String.fromCharCode(65 + i)}. ${question.choices[i]}`;
                choiceBtn.style.display = 'block';
                choiceBtn.disabled = false;
                choiceBtn.className = 'choice-btn';
            }
            
            document.getElementById('nextBtn').style.display = 'none';
            selectedAnswer = null;
            isAnswered = false;
            
            log(`üìù ÂïèÈ°å${currentQuestionIndex + 1}„ÇíË°®Á§∫: ${question.question}`);
        }
        
        // ÂõûÁ≠îÈÅ∏Êäû
        window.selectAnswer = (choiceNumber) => {
            if (isAnswered) return;
            
            selectedAnswer = choiceNumber - 1;
            isAnswered = true;
            
            const question = quizData[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correct;
            
            // ÂÖ®„Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`choice${i}`).disabled = true;
            }
            
            // Ê≠£Ëß£„Éª‰∏çÊ≠£Ëß£„ÅÆË°®Á§∫
            for (let i = 0; i < 4; i++) {
                const choiceBtn = document.getElementById(`choice${i + 1}`);
                if (i === question.correct) {
                    choiceBtn.classList.add('correct');
                } else if (i === selectedAnswer) {
                    choiceBtn.classList.add('incorrect');
                }
            }
            
            if (isCorrect) {
                score++;
                log(`‚úÖ Ê≠£Ëß£ÔºÅ ${question.explanation}`);
            } else {
                log(`‚ùå ‰∏çÊ≠£Ëß£... Ê≠£Ëß£„ÅØ${String.fromCharCode(65 + question.correct)}„Åß„Åô„ÄÇ${question.explanation}`);
            }
            
            updateScore();
            
            // „ÉÜ„É≥„Éù„Ç¢„ÉÉ„ÉóÔºö1.2ÁßíÂæå„Å´Ëá™Âãï„ÅßÊ¨°„ÅÆÂïèÈ°å„Å∏
            setTimeout(() => {
                nextQuestion();
            }, 1200);
        };
        
        // Ê¨°„ÅÆÂïèÈ°å
        window.nextQuestion = () => {
            currentQuestionIndex++;
            showQuestion();
        };
        
        // ÁµêÊûúË°®Á§∫
        function showResults() {
            const percentage = Math.round((score / quizData.length) * 100);
            let message = '';
            
            if (percentage >= 80) {
                message = 'üèÜ Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ';
            } else if (percentage >= 60) {
                message = 'üëç „Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ';
            } else if (percentage >= 40) {
                message = 'üìö „ÇÇ„ÅÜÂ∞ë„ÅóÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ';
            } else {
                message = 'üí™ Ê¨°Âõû„ÅØ„ÇÇ„Å£„Å®È†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ';
            }
            
            document.getElementById('questionNumber').textContent = 'ÁµêÊûúÁô∫Ë°®';
            document.getElementById('questionText').innerHTML = `
                <div style="text-align: center; font-size: 18px;">
                    <div style="margin-bottom: 15px;">${message}</div>
                    <div style="font-size: 24px; color: #007bff; margin-bottom: 10px;">
                        ${score} / ${quizData.length} ÂïèÊ≠£Ëß£
                    </div>
                    <div style="font-size: 16px; color: #666;">
                        Ê≠£Á≠îÁéá: ${percentage}%
                    </div>
                </div>
            `;
            
            // ÈÅ∏ÊäûËÇ¢„ÇíÈùûË°®Á§∫
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`choice${i}`).style.display = 'none';
            }
            
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('restartBtn').style.display = 'inline-block';
            document.getElementById('showGraphBtn').style.display = 'inline-block';
            
            // Firebase „Å´Ë®òÈå≤„Çí‰øùÂ≠ò
            saveQuizResult(score, quizData.length, percentage);
            
            log(`üéØ „ÇØ„Ç§„Ç∫ÁµÇ‰∫ÜÔºÅ ${score}/${quizData.length}ÂïèÊ≠£Ëß£ (${percentage}%)`);
        }
        
        // „ÇØ„Ç§„Ç∫ÂÜçÈñãÂßã
        window.restartQuiz = () => {
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('restartBtn').style.display = 'none';
            
            document.getElementById('questionNumber').textContent = 'ÂïèÈ°å 1';
            document.getElementById('questionText').textContent = '„ÇØ„Ç§„Ç∫„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
            
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`choice${i}`).style.display = 'none';
            }
            
            currentQuestionIndex = 0;
            score = 0;
            updateScore();
            
            log('üîÑ „ÇØ„Ç§„Ç∫„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
        };
        
        // „Çπ„Ç≥„Ç¢Êõ¥Êñ∞
        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('totalQuestions').textContent = quizData.length;
        }
        
        // „ÇØ„Ç§„Ç∫ÁµêÊûú„ÇíFirebase„Å´‰øùÂ≠ò
        async function saveQuizResult(correctAnswers, totalQuestions, percentage) {
            if (!currentUser) {
                log('‚ùå „É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô');
                return;
            }
            
            try {
                const quizResult = {
                    score: correctAnswers,
                    total: totalQuestions,
                    percentage: percentage,
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString(),
                    userEmail: currentUser.email,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    createdAt: new Date().toISOString()
                };
                
                const userRef = database.ref(`users/${currentUser.uid}/quiz_results`);
                await userRef.push(quizResult);
                
                log(`üìä „ÇØ„Ç§„Ç∫ÁµêÊûú„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü: ${correctAnswers}/${totalQuestions} (${percentage}%)`);
                
                // Â±•Ê≠¥„ÇíÂÜçË™≠„ÅøËæº„Åø
                loadQuizHistory();
            } catch (error) {
                log(`‚ùå ÁµêÊûú‰øùÂ≠ò„Ç®„É©„Éº: ${error.message}`);
            }
        }
        
        // „ÇØ„Ç§„Ç∫Â±•Ê≠¥„ÇíË™≠„ÅøËæº„Åø
        function loadQuizHistory() {
            if (!currentUser) return;
            
            const userRef = database.ref(`users/${currentUser.uid}/quiz_results`);
            userRef.on('value', (snapshot) => {
                const data = snapshot.val();
                
                if (data) {
                    quizHistory = Object.entries(data)
                        .map(([key, value]) => ({ id: key, ...value }))
                        .sort((a, b) => new Date(a.createdAt || a.date) - new Date(b.createdAt || b.date));
                    
                    log(`üìà „ÇØ„Ç§„Ç∫Â±•Ê≠¥Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü: ${quizHistory.length}‰ª∂`);
                } else {
                    quizHistory = [];
                    log('üìà „ÇØ„Ç§„Ç∫Â±•Ê≠¥: „Éá„Éº„Çø„Å™„Åó');
                }
            });
        }
        
        // „Ç∞„É©„ÉïË°®Á§∫
        window.showGraph = () => {
            if (quizHistory.length === 0) {
                log('‚ùå Ë°®Á§∫„Åô„Çã„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            document.querySelector('.graph-panel').classList.remove('hidden');
            
            // „Ç∞„É©„Éï„Éá„Éº„Çø„ÇíÊ∫ñÂÇô
            const labels = quizHistory.slice(-10).map((result, index) => `${index + 1}ÂõûÁõÆ`);
            const percentageData = quizHistory.slice(-10).map(result => result.percentage);
            const scoreData = quizHistory.slice(-10).map(result => `${result.score}/${result.total}`);
            
            // Êó¢Â≠ò„ÅÆ„Ç∞„É©„Éï„ÇíÂâäÈô§
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Chart.js„Åß„Ç∞„É©„Éï„Çí‰ΩúÊàê
            const ctx = document.getElementById('scoreChart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Ê≠£Á≠îÁéá (%)',
                        data: percentageData,
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#007bff',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '„ÇØ„Ç§„Ç∫ÊàêÁ∏æÊé®Áßª',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    elements: {
                        point: {
                            hoverRadius: 8
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
            
            log(`üìä ÊàêÁ∏æ„Ç∞„É©„Éï„ÇíË°®Á§∫„Åó„Åæ„Åó„ÅüÔºàÈÅéÂéª${Math.min(quizHistory.length, 10)}ÂõûÂàÜÔºâ`);
        };
        
        // „Ç∞„É©„Éï„ÇíÈö†„Åô
        window.hideGraph = () => {
            document.querySelector('.graph-panel').classList.add('hidden');
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
        };
        
        // Â±•Ê≠¥ÂâäÈô§
        window.clearHistory = async () => {
            if (!currentUser) {
                log('‚ùå „É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô');
                return;
            }
            
            if (!confirm('„ÇØ„Ç§„Ç∫Â±•Ê≠¥„Çí„Åô„Åπ„Å¶ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                return;
            }
            
            try {
                const userRef = database.ref(`users/${currentUser.uid}/quiz_results`);
                await userRef.remove();
                quizHistory = [];
                hideGraph();
                log('üóëÔ∏è „ÇØ„Ç§„Ç∫Â±•Ê≠¥„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
            } catch (error) {
                log(`‚ùå Â±•Ê≠¥ÂâäÈô§„Ç®„É©„Éº: ${error.message}`);
            }
        };
        
        // ÊèèÁîªÈñãÂßã
        function startDrawing(e) {
            isDrawing = true;
            const pos = getMousePos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
            
            // Èü≥ÈüøÂäπÊûú
            playSound('brush');
        }
        
        // ÊèèÁîª‰∏≠
        function draw(e) {
            if (!isDrawing) return;
            
            const pos = getMousePos(e);
            
            switch(currentTool) {
                case 'brush':
                    drawBrush(pos.x, pos.y);
                    break;
                case 'pencil':
                    drawPencil(pos.x, pos.y);
                    break;
                case 'spray':
                    drawSpray(pos.x, pos.y);
                    break;
                case 'glow':
                    drawGlow(pos.x, pos.y);
                    break;
                case 'neon':
                    drawNeon(pos.x, pos.y);
                    break;
                case 'particle':
                    drawParticle(pos.x, pos.y);
                    break;
            }
        }
        
        // ÊèèÁîªÂÅúÊ≠¢
        function stopDrawing() {
            isDrawing = false;
            ctx.beginPath();
        }
        
        // „Éû„Ç¶„ÇπÂ∫ßÊ®ôÂèñÂæó
        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: (e.clientX || e.touches[0].clientX) - rect.left,
                y: (e.clientY || e.touches[0].clientY) - rect.top
            };
        }
        
        // „Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„ÉàÂá¶ÁêÜ
        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }
        
        // „ÉÑ„Éº„É´ÈÅ∏Êäû
        window.selectTool = (tool) => {
            currentTool = tool;
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tool="${tool}"]`).classList.add('active');
            log(`üñåÔ∏è „ÉÑ„Éº„É´ÈÅ∏Êäû: ${tool}`);
        };
        
        // „Éñ„É©„Ç∑„Çµ„Ç§„Ç∫Êõ¥Êñ∞
        function updateBrushSize() {
            currentSize = parseInt(document.getElementById('brushSize').value);
            document.getElementById('brushSizeDisplay').textContent = currentSize;
        }
        
        // „Ç´„É©„ÉºÊõ¥Êñ∞
        function updateColor() {
            currentColor = document.getElementById('colorPicker').value;
        }
        
        // ÈÄèÊòéÂ∫¶Êõ¥Êñ∞
        function updateOpacity() {
            currentOpacity = parseInt(document.getElementById('opacity').value) / 100;
            document.getElementById('opacityDisplay').textContent = Math.round(currentOpacity * 100) + '%';
        }
        
        // Âü∫Êú¨„Éñ„É©„Ç∑ÊèèÁîªÔºà„Éì„Ç∏„É•„Ç¢„É´Âº∑ÂåñÔºâ
        function drawBrush(x, y) {
            ctx.globalAlpha = currentOpacity;
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = currentSize;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // „É°„Çø„É™„ÉÉ„ÇØÂäπÊûúËøΩÂä†
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, currentSize);
            gradient.addColorStop(0, currentColor);
            gradient.addColorStop(1, currentColor + '80');
            ctx.strokeStyle = gradient;
            
            ctx.lineTo(x, y);
            ctx.stroke();
        }
        
        // „Éö„É≥„Ç∑„É´ÊèèÁîª
        function drawPencil(x, y) {
            ctx.globalAlpha = currentOpacity;
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = Math.max(1, currentSize / 3);
            ctx.lineCap = 'round';
            ctx.lineTo(x, y);
            ctx.stroke();
        }
        
        // „Çπ„Éó„É¨„ÉºÊèèÁîªÔºà„É¨„Ç§„É≥„Éú„Éº„Ç®„Éï„Çß„ÇØ„Éà‰ªò„ÅçÔºâ
        function drawSpray(x, y) {
            ctx.globalAlpha = currentOpacity * 0.8;
            
            for (let i = 0; i < currentSize * 2; i++) {
                const offsetX = (Math.random() - 0.5) * currentSize * 3;
                const offsetY = (Math.random() - 0.5) * currentSize * 3;
                const distance = Math.sqrt(offsetX * offsetX + offsetY * offsetY);
                
                if (distance < currentSize * 1.5) {
                    // „Ç´„É©„Éï„É´„Å™„Çπ„Éó„É¨„ÉºÂäπÊûú
                    const hue = (Date.now() / 10 + i * 10) % 360;
                    const saturation = 70 + Math.random() * 30;
                    const lightness = 50 + Math.random() * 30;
                    ctx.fillStyle = `hsla(${hue}, ${saturation}%, ${lightness}%, ${0.6 + Math.random() * 0.4})`;
                    
                    const size = Math.max(1, 3 - distance / currentSize);
                    ctx.fillRect(x + offsetX, y + offsetY, size, size);
                }
            }
        }
        
        // „Ç∞„É≠„ÉºÂäπÊûúÔºà„Éû„É´„ÉÅ„É¨„Ç§„É§„ÉºÂº∑ÂåñÔºâ
        function drawGlow(x, y) {
            // Â§ñÂÅ¥„ÅÆÂ§ß„Åç„Å™„Ç∞„É≠„Éº
            ctx.globalAlpha = currentOpacity * 0.3;
            ctx.shadowColor = currentColor;
            ctx.shadowBlur = currentSize * 4;
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = currentSize * 1.5;
            ctx.lineCap = 'round';
            ctx.lineTo(x, y);
            ctx.stroke();
            
            // ‰∏≠Èñì„Ç∞„É≠„Éº
            ctx.globalAlpha = currentOpacity * 0.6;
            ctx.shadowBlur = currentSize * 2;
            ctx.lineWidth = currentSize;
            ctx.lineTo(x, y);
            ctx.stroke();
            
            // ÂÜÖÂÅ¥„ÅÆ„Ç≥„Ç¢
            ctx.globalAlpha = currentOpacity;
            ctx.shadowBlur = currentSize;
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = currentSize * 0.3;
            ctx.lineTo(x, y);
            ctx.stroke();
            
            ctx.shadowBlur = 0;
        }
        
        // „Éç„Ç™„É≥ÂäπÊûú
        function drawNeon(x, y) {
            // Â§ñÂÅ¥„ÅÆ„Ç∞„É≠„Éº
            ctx.globalAlpha = currentOpacity * 0.3;
            ctx.shadowColor = currentColor;
            ctx.shadowBlur = currentSize * 3;
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = currentSize * 2;
            ctx.lineCap = 'round';
            ctx.lineTo(x, y);
            ctx.stroke();
            
            // ÂÜÖÂÅ¥„ÅÆÊòé„Çã„ÅÑÁ∑ö
            ctx.globalAlpha = currentOpacity;
            ctx.shadowBlur = currentSize;
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = currentSize / 2;
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.shadowBlur = 0;
        }
        
        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÂäπÊûúÔºàÊòüÂ∫ß„Ç®„Éï„Çß„ÇØ„ÉàÔºâ
        function drawParticle(x, y) {
            // Â§öÂΩ©„Å™„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÇíËøΩÂä†
            for (let i = 0; i < 8; i++) {
                const angle = (Math.PI * 2 * i) / 8 + Math.random() * 0.5;
                const speed = 2 + Math.random() * 3;
                const hue = (Date.now() / 50 + i * 45) % 360;
                
                particles.push({
                    x: x + Math.random() * 10 - 5,
                    y: y + Math.random() * 10 - 5,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    life: 1.0,
                    color: `hsl(${hue}, 100%, 60%)`,
                    size: Math.random() * currentSize / 2 + 2,
                    sparkle: Math.random() > 0.5,
                    trail: []
                });
            }
        }
        
        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÔºàÂº∑ÂåñÁâàÔºâ
        function animateParticles() {
            particles.forEach((particle, index) => {
                // „Éà„É¨„Ç§„É´Ë®òÈå≤
                if (particle.trail) {
                    particle.trail.push({x: particle.x, y: particle.y, life: particle.life});
                    if (particle.trail.length > 5) particle.trail.shift();
                }
                
                // Áâ©ÁêÜÊõ¥Êñ∞
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.vx *= 0.98; // Á©∫Ê∞óÊäµÊäó
                particle.vy *= 0.98;
                particle.life -= 0.015;
                particle.size *= 0.995;
                
                if (particle.life <= 0 || particle.size < 0.5) {
                    particles.splice(index, 1);
                } else {
                    // „Éà„É¨„Ç§„É´ÊèèÁîª
                    if (particle.trail) {
                        particle.trail.forEach((point, i) => {
                            ctx.globalAlpha = point.life * 0.3;
                            ctx.fillStyle = particle.color;
                            const trailSize = particle.size * (i / particle.trail.length);
                            ctx.fillRect(point.x, point.y, trailSize, trailSize);
                        });
                    }
                    
                    // „É°„Ç§„É≥ÊèèÁîª
                    ctx.globalAlpha = particle.life;
                    if (particle.sparkle && Math.random() > 0.8) {
                        ctx.shadowColor = particle.color;
                        ctx.shadowBlur = particle.size * 2;
                    }
                    ctx.fillStyle = particle.color;
                    ctx.fillRect(particle.x, particle.y, particle.size, particle.size);
                    ctx.shadowBlur = 0;
                }
            });
            
            requestAnimationFrame(animateParticles);
        }
        
        // „Ç≠„É£„É≥„Éê„Çπ„ÇØ„É™„Ç¢
        window.clearCanvas = () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles = [];
            playSound('clear');
            log('üóëÔ∏è „Ç≠„É£„É≥„Éê„Çπ„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü');
        };
        
        // ‰ΩúÂìÅ‰øùÂ≠òÔºàFirebaseÔºâ
        window.savePainting = async () => {
            if (!currentUser) {
                log('‚ùå „É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô');
                return;
            }
            
            const title = document.getElementById('paintingTitle').value || 'ÁÑ°È°å„ÅÆ‰ΩúÂìÅ';
            const imageData = canvas.toDataURL();
            
            try {
                const paintingData = {
                    title: title,
                    canvasData: imageData,
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString(),
                    userEmail: currentUser.email,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    createdAt: new Date().toISOString()
                };
                
                const userRef = database.ref(`users/${currentUser.uid}/paintings`);
                await userRef.push(paintingData);
                
                playSound('save');
                log(`‚úÖ ‰ΩúÂìÅ‰øùÂ≠òÂÆå‰∫Ü: ${title}`);
                document.getElementById('paintingTitle').value = '';
            } catch (error) {
                log(`‚ùå ‰øùÂ≠ò„Ç®„É©„Éº: ${error.message}`);
            }
        };
        
        // ‰ΩúÂìÅ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        window.downloadPainting = () => {
            const title = document.getElementById('paintingTitle').value || 'awesome-painting';
            const link = document.createElement('a');
            link.download = `${title}.png`;
            link.href = canvas.toDataURL();
            link.click();
            log(`üíæ ‰ΩúÂìÅ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ: ${title}.png`);
        };
        
        // Èü≥ÈüøÂäπÊûú
        function playSound(type) {
            try {
                // Web Audio API„Çí‰ΩøÁî®„Åó„ÅüÁ∞°Âçò„Å™Èü≥ÁîüÊàê
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                switch(type) {
                    case 'brush':
                        oscillator.frequency.value = 220;
                        gainNode.gain.value = 0.05;
                        break;
                    case 'save':
                        oscillator.frequency.value = 440;
                        gainNode.gain.value = 0.1;
                        break;
                    case 'clear':
                        oscillator.frequency.value = 110;
                        gainNode.gain.value = 0.05;
                        break;
                }
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                // Èü≥Èüø„Åå‰Ωø„Åà„Å™„ÅÑÂ†¥Âêà„ÅØÁÑ°Ë¶ñ
            }
        }

        function showLoginInterface() {
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('userPanel').classList.add('hidden');
        }

        // „É≠„Ç∞Âá∫ÂäõÈñ¢Êï∞
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.innerHTML += `[${timestamp}] ${message}<br>`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }

        // „É≠„Ç∞„Ç≥„Éî„ÉºÊ©üËÉΩ
        window.copyLogs = () => {
            const logArea = document.getElementById('logArea');
            const logText = logArea.innerText || logArea.textContent;
            navigator.clipboard.writeText(logText).then(() => {
                alert('‚úÖ „É≠„Ç∞„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
            }).catch(() => {
                // fallback
                const textArea = document.createElement('textarea');
                textArea.value = logText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('‚úÖ „É≠„Ç∞„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
            });
        };

        // FirebaseÊé•Á∂ö„Éá„Éê„ÉÉ„Ç∞
        window.debugFirebaseConnection = () => {
            log('üîç === Firebase Debug ÈñãÂßã ===');
            
            // 1. FirebaseË®≠ÂÆöÁ¢∫Ë™ç
            log(`üî• Firebase ConfigÁ¢∫Ë™ç:`);
            log(`- Project ID: ${firebaseConfig.projectId}`);
            log(`- Database URL: ${firebaseConfig.databaseURL}`);
            log(`- Auth Domain: ${firebaseConfig.authDomain}`);
            
            // 2. Ë™çË®ºÁä∂ÊÖãÁ¢∫Ë™ç
            if (currentUser) {
                log(`‚úÖ Ë™çË®ºÊ∏à„Åø„É¶„Éº„Ç∂„Éº:`);
                log(`- UID: ${currentUser.uid.substring(0,8)}...`);
                log(`- Email: ${currentUser.email}`);
                log(`- Ë°®Á§∫Âêç: ${currentUser.displayName}`);
            } else {
                log('‚ùå Êú™Ë™çË®ºÁä∂ÊÖã');
            }
            
            // 3. Êé•Á∂ö„ÉÜ„Çπ„Éà
            const connectedRef = database.ref('.info/connected');
            connectedRef.once('value', (snapshot) => {
                const connected = snapshot.val();
                log(`üåê FirebaseÊé•Á∂öÁä∂ÊÖã: ${connected ? 'Êé•Á∂ö‰∏≠' : 'Êú™Êé•Á∂ö'}`);
                
                if (connected && currentUser) {
                    // „Éá„Éº„Çø„Éô„Éº„Çπ„ÉÜ„Çπ„Éà
                    const testRef = database.ref(`users/${currentUser.uid}/test`);
                    testRef.set({
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        message: 'Connection test',
                        app: 'app-template'
                    }).then(() => {
                        log('‚úÖ „Éá„Éº„Çø„Éô„Éº„ÇπÊõ∏„ÅçËæº„Åø„ÉÜ„Çπ„ÉàÊàêÂäü');
                    }).catch((error) => {
                        log(`‚ùå „Éá„Éº„Çø„Éô„Éº„ÇπÊõ∏„ÅçËæº„Åø„Ç®„É©„Éº: ${error.message}`);
                        log(`- Error Code: ${error.code}`);
                    });
                }
            });
            
            log('üîç === Firebase Debug ÂÆå‰∫Ü ===');
        };

        // „É¢„Éê„Ç§„É´Áí∞Â¢ÉË®∫Êñ≠
        window.checkMobileSupport = () => {
            log('üì± === „É¢„Éê„Ç§„É´Áí∞Â¢ÉË®∫Êñ≠ ÈñãÂßã ===');
            
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            log(`üåê „É¶„Éº„Ç∂„Éº„Ç®„Éº„Ç∏„Çß„É≥„Éà: ${userAgent}`);
            log(`üì± „É¢„Éê„Ç§„É´„Éá„Éê„Ç§„ÇπÂà§ÂÆö: ${isMobile ? '„É¢„Éê„Ç§„É´' : '„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó'}`);
            
            // „Éñ„É©„Ç¶„Ç∂Âà§ÂÆö
            const isChrome = /Chrome/i.test(userAgent);
            const isSafari = /Safari/i.test(userAgent) && !/Chrome/i.test(userAgent);
            const isFirefox = /Firefox/i.test(userAgent);
            
            log(`üåê „Éñ„É©„Ç¶„Ç∂: ${isChrome ? 'Chrome' : isSafari ? 'Safari' : isFirefox ? 'Firefox' : '‰∏çÊòé'}`);
            
            // „É≠„Ç∞„Ç§„É≥ÊñπÂºè„ÅÆÊé®Â•®
            if (isMobile) {
                log('üí° „É¢„Éê„Ç§„É´„ÅÆÊé®Â•®Ë®≠ÂÆö:');
                log('- Google„É≠„Ç∞„Ç§„É≥„ÅØ„É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÊñπÂºè„Çí‰ΩøÁî®');
                log('- „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Éñ„É≠„ÉÉ„Ç´„Éº„ÅÆÂΩ±Èüø„Å™„Åó');
                log('- Ë™çË®ºÂæå„Å´„Éö„Éº„Ç∏„ÅåÂÜçË™≠„ÅøËæº„Åø„Åï„Çå„Åæ„Åô');
            }
            
            log('üì± === „É¢„Éê„Ç§„É´Áí∞Â¢ÉË®∫Êñ≠ ÂÆå‰∫Ü ===');
        };

        // FirebaseË®≠ÂÆöË®∫Êñ≠
        window.checkFirebaseConfig = () => {
            log('üîß === FirebaseË®≠ÂÆöË®∫Êñ≠ ÈñãÂßã ===');
            
            // ÁèæÂú®„ÅÆ„Éâ„É°„Ç§„É≥Á¢∫Ë™ç
            const currentDomain = window.location.hostname;
            const currentUrl = window.location.href;
            log(`üåê ÁèæÂú®„ÅÆ„Éâ„É°„Ç§„É≥: ${currentDomain}`);
            log(`üîó ÁèæÂú®„ÅÆURL: ${currentUrl}`);
            
            // FirebaseË®≠ÂÆöÊÉÖÂ†±
            log(`üî• FirebaseË®≠ÂÆö:`);
            log(`- Project ID: ${firebaseConfig.projectId}`);
            log(`- Auth Domain: ${firebaseConfig.authDomain}`);
            log(`- Database URL: ${firebaseConfig.databaseURL}`);
            
            // Ë™çË®º„Éâ„É°„Ç§„É≥Ë®±ÂèØÁä∂Ê≥Å„ÅÆÊé®Ê∏¨
            if (currentDomain === 'muumuu8181.github.io') {
                log('‚úÖ GitHub Pages„Éâ„É°„Ç§„É≥Ê§úÂá∫');
                log('üí° Firebase Console„Åß„Åì„ÅÆ„Éâ„É°„Ç§„É≥„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„ÅåÂøÖË¶Å');
            } else if (currentDomain === 'localhost' || currentDomain === '127.0.0.1') {
                log('‚úÖ „É≠„Éº„Ç´„É´„Éõ„Çπ„ÉàÊ§úÂá∫');
                log('üí° ÈÄöÂ∏∏„ÅØËá™Âãï„ÅßË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô');
            } else {
                log('‚ö†Ô∏è ‰∏çÊòé„Å™„Éâ„É°„Ç§„É≥„Åß„Åô');
                log('üí° Firebase Console„ÅÆË™çË®ºË®≠ÂÆö„ÅßË®±ÂèØ„ÅåÂøÖË¶Å„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì');
            }
            
            // „É¢„Éê„Ç§„É´„Éñ„É©„Ç¶„Ç∂„Åß„ÅÆ„É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÂà∂ÈôêÁ¢∫Ë™ç
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            if (isMobile) {
                log('üì± „É¢„Éê„Ç§„É´„Éñ„É©„Ç¶„Ç∂Âõ∫Êúâ„ÅÆÂà∂Èôê:');
                log('- Safari: „Çµ„Éº„Éâ„Éë„Éº„ÉÜ„Ç£Cookie„ÅÆÂà∂Èôê„ÅÇ„Çä');
                log('- Chrome Mobile: „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅÆËá™Âãï„Éñ„É≠„ÉÉ„ÇØ');
                log('- Ëß£Ê±∫Á≠ñ: „É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÊñπÂºè„Åæ„Åü„ÅØ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË®±ÂèØË®≠ÂÆö');
            }
            
            log('üîß === FirebaseË®≠ÂÆöË®∫Êñ≠ ÂÆå‰∫Ü ===');
        };

        // Ë™çË®ºÁä∂ÊÖã„ÅÆÂº∑Âà∂Á¢∫Ë™ç
        window.forceAuthCheck = () => {
            log('üîç === Ë™çË®ºÁä∂ÊÖãÂº∑Âà∂Á¢∫Ë™ç ÈñãÂßã ===');
            
            const user = auth.currentUser;
            log(`üîê FirebaseË™çË®ºÁä∂ÊÖã: ${user ? `„É≠„Ç∞„Ç§„É≥Ê∏à„Åø (${user.displayName})` : 'Êú™„É≠„Ç∞„Ç§„É≥'}`);
            
            if (user) {
                log('‚úÖ „É¶„Éº„Ç∂„ÉºÁîªÈù¢„ÇíË°®Á§∫„Åó„Åæ„Åô');
                showUserInterface(user);
                loadUserWeightData(user.uid);
            } else {
                log('‚ùå „É≠„Ç∞„Ç§„É≥ÁîªÈù¢„ÇíË°®Á§∫„Åó„Åæ„Åô');
                showLoginInterface();
            }
            
            // Ë™çË®º„Éà„Éº„ÇØ„É≥„ÅÆÊúâÂäπÊÄßÁ¢∫Ë™ç
            if (user) {
                user.getIdToken(true).then(() => {
                    log('‚úÖ Ë™çË®º„Éà„Éº„ÇØ„É≥„ÅØÊúâÂäπ„Åß„Åô');
                }).catch((tokenError) => {
                    log(`‚ùå Ë™çË®º„Éà„Éº„ÇØ„É≥„Ç®„É©„Éº: ${tokenError.message}`);
                    log('üí° ÂÜç„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì');
                });
            }
            
            log('üîç === Ë™çË®ºÁä∂ÊÖãÂº∑Âà∂Á¢∫Ë™ç ÂÆå‰∫Ü ===');
        };

        // „É≠„Ç∞„Ç§„É≥ÂïèÈ°åË®∫Êñ≠
        window.checkLoginIssues = () => {
            log('‚ö†Ô∏è === „É≠„Ç∞„Ç§„É≥ÂïèÈ°åË®∫Êñ≠ ÈñãÂßã ===');
            
            // 1. „Éó„É≠„Éà„Ç≥„É´„ÉÅ„Çß„ÉÉ„ÇØ
            const protocol = window.location.protocol;
            log(`üåê ÁèæÂú®„ÅÆ„Éó„É≠„Éà„Ç≥„É´: ${protocol}`);
            
            if (protocol === 'file:') {
                log('‚ùå ÂïèÈ°åÁô∫Ë¶ã: file://„Éó„É≠„Éà„Ç≥„É´„Åß„ÅØGoogleË™çË®º„ÅåÂãï‰Ωú„Åó„Åæ„Åõ„Çì');
                log('‚úÖ Ëß£Ê±∫ÊñπÊ≥ï:');
                log('  1. HTTP„Çµ„Éº„Éê„ÉºÁµåÁî±„Åß„Ç¢„ÇØ„Çª„Çπ');
                log('  2. chrome://flags „Åß insecure origins „ÇíË®±ÂèØ');
                log('  3. „É≠„Éº„Ç´„É´„Çµ„Éº„Éê„ÉºËµ∑Âãï (python -m http.server 8000)');
            } else if (protocol === 'https:' || protocol === 'http:') {
                log('‚úÖ „Éó„É≠„Éà„Ç≥„É´: ÂïèÈ°å„Å™„Åó');
            }
            
            // 2. Web StorageÁ¢∫Ë™ç
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                log('‚úÖ Web Storage: Âà©Áî®ÂèØËÉΩ');
            } catch (e) {
                log('‚ùå Web Storage: ÁÑ°Âäπ');
                log('‚úÖ Ëß£Ê±∫ÊñπÊ≥ï: „Éñ„É©„Ç¶„Ç∂Ë®≠ÂÆö„ÅßCookie„ÇíÊúâÂäπ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
            
            // 3. Firebase„É©„Ç§„Éñ„É©„É™Á¢∫Ë™ç
            if (typeof firebase !== 'undefined') {
                log('‚úÖ Firebase SDK: Ë™≠„ÅøËæº„ÅøÊ∏à„Åø');
                log(`- Firebase Version: ${firebase.SDK_VERSION || 'Unknown'}`);
            } else {
                log('‚ùå Firebase SDK: Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº');
            }
            
            // 4. „Éâ„É°„Ç§„É≥Á¢∫Ë™ç
            const domain = window.location.hostname;
            log(`üè† ÁèæÂú®„ÅÆ„Éâ„É°„Ç§„É≥: ${domain}`);
            
            if (domain === 'localhost' || domain === '127.0.0.1') {
                log('‚úÖ „É≠„Éº„Ç´„É´ÈñãÁô∫: FirebaseË®≠ÂÆö„ÅßË®±ÂèØ„ÅåÂøÖË¶Å');
            }
            
            log('‚ö†Ô∏è === „É≠„Ç∞„Ç§„É≥ÂïèÈ°åË®∫Êñ≠ ÂÆå‰∫Ü ===');
        };

        // „Éá„Éº„Çø„Éô„Éº„ÇπÊßãÈÄ†Á¢∫Ë™ç
        window.checkDatabaseStructure = async () => {
            if (!currentUser) {
                log('‚ùå „É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô');
                return;
            }
            
            log('üèóÔ∏è === „Éá„Éº„Çø„Éô„Éº„ÇπÊßãÈÄ†Á¢∫Ë™ç ÈñãÂßã ===');
            
            try {
                // ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„Éº„ÅÆweights„Éá„Éº„ÇøÊßãÈÄ†„ÇíÁ¢∫Ë™ç
                const userRef = database.ref(`users/${currentUser.uid}/weights`);
                const snapshot = await userRef.once('value');
                const data = snapshot.val();
                
                if (data) {
                    const entries = Object.keys(data);
                    log(`üìä ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„Éº(${currentUser.email})„ÅÆ„Éá„Éº„Çø:`);
                    log(`- Ë®òÈå≤Êï∞: ${entries.length}‰ª∂`);
                    log(`- ÊúÄÊñ∞Ë®òÈå≤ID: ${entries[entries.length - 1]}`);
                    
                    // „Çµ„É≥„Éó„É´„Éá„Éº„ÇøÊßãÈÄ†„ÇíË°®Á§∫
                    const sampleEntry = data[entries[0]];
                    log(`- „Éá„Éº„ÇøÊßãÈÄ†: ${JSON.stringify(sampleEntry, null, 2)}`);
                } else {
                    log('üìä ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„Éº„Å´„ÅØ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                }
                
                // „É´„Éº„Éà„É¨„Éô„É´„ÅÆÊßãÈÄ†Á¢∫Ë™çÔºàÁÆ°ÁêÜËÄÖÊ®©Èôê„ÅåÂøÖË¶ÅÔºâ
                try {
                    const rootRef = database.ref('users');
                    const rootSnapshot = await rootRef.once('value');
                    const allUsers = rootSnapshot.val();
                    
                    if (allUsers) {
                        const userCount = Object.keys(allUsers).length;
                        log(`üë• ÂÖ®‰ΩìÁµ±Ë®à:`);
                        log(`- ÁôªÈå≤„É¶„Éº„Ç∂„ÉºÊï∞: ${userCount}‰∫∫`);
                        
                        let totalWeights = 0;
                        Object.values(allUsers).forEach(user => {
                            if (user.weights) {
                                totalWeights += Object.keys(user.weights).length;
                            }
                        });
                        log(`- ÂÖ®‰Ωì„ÅÆË®òÈå≤Êï∞: ${totalWeights}‰ª∂`);
                    }
                } catch (error) {
                    log(`‚ö†Ô∏è ÂÖ®‰ΩìÁµ±Ë®à„ÅÆÂèñÂæó„Å´Âà∂Èôê„Åå„ÅÇ„Çä„Åæ„Åô: ${error.message}`);
                }
                
            } catch (error) {
                log(`‚ùå ÊßãÈÄ†Á¢∫Ë™ç„Ç®„É©„Éº: ${error.message}`);
            }
            
            log('üèóÔ∏è === „Éá„Éº„Çø„Éô„Éº„ÇπÊßãÈÄ†Á¢∫Ë™ç ÂÆå‰∫Ü ===');
        };

        // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Çí„Ç≥„Éî„Éº
        window.copyDebugInfo = () => {
            const debugInfo = `„Ç¢„Éó„É™„ÉÜ„É≥„Éó„É¨„Éº„Éà v0.24 „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±
=================================
„Çø„Ç§„É†„Çπ„Çø„É≥„Éó: ${new Date().toLocaleString()}
URL: ${window.location.href}
„Éó„É≠„Éà„Ç≥„É´: ${window.location.protocol}
„Éâ„É°„Ç§„É≥: ${window.location.hostname}
„É¶„Éº„Ç∂„Éº„Ç®„Éº„Ç∏„Çß„É≥„Éà: ${navigator.userAgent}

FirebaseË®≠ÂÆö:
- „Éó„É≠„Ç∏„Çß„ÇØ„ÉàID: ${firebaseConfig.projectId}
- „Éá„Éº„Çø„Éô„Éº„ÇπURL: ${firebaseConfig.databaseURL}
- Ë™çË®º„Éâ„É°„Ç§„É≥: ${firebaseConfig.authDomain}

Ë™çË®ºÁä∂ÊÖã: ${currentUser ? '„É≠„Ç∞„Ç§„É≥Ê∏à„Åø' : 'Êú™„É≠„Ç∞„Ç§„É≥'}
${currentUser ? `- UID: ${currentUser.uid.substring(0,8)}...\n- Email: ${currentUser.email}\n- Ë°®Á§∫Âêç: ${currentUser.displayName}` : ''}

Firebase SDK: ${typeof firebase !== 'undefined' ? 'Ë™≠„ÅøËæº„ÅøÊ∏à„Åø' : 'Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº'}
Web Storage: ${(() => {
    try {
        localStorage.setItem('test', 'test');
        localStorage.removeItem('test');
        return 'Âà©Áî®ÂèØËÉΩ';
    } catch (e) {
        return 'ÁÑ°Âäπ';
    }
})()}

„É≠„Ç∞ÂÜÖÂÆπ:
${document.getElementById('logArea').innerText}`;

            navigator.clipboard.writeText(debugInfo).then(() => {
                alert('‚úÖ „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
            }).catch(() => {
                // fallback
                const textArea = document.createElement('textarea');
                textArea.value = debugInfo;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('‚úÖ „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
            });
        };

        // ÂàùÊúüÂåñ
        // „Éë„Éç„É´„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
        window.togglePanelMode = () => {
            document.body.classList.toggle('panel-mode');
            const btn = document.querySelector('.mode-toggle');
            if (document.body.classList.contains('panel-mode')) {
                btn.textContent = 'üìä „Éë„Éç„É´Ë°®Á§∫';
                log('üìä „Éë„Éç„É´Ë°®Á§∫„É¢„Éº„Éâ: ON');
            } else {
                btn.textContent = 'üìÑ ÈÄöÂ∏∏Ë°®Á§∫';
                log('üìÑ „Éë„Éç„É´Ë°®Á§∫„É¢„Éº„Éâ: OFF');
            }
        };
        
        // „Ç∞„É™„ÉÉ„Éâ„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
        window.toggleGridMode = () => {
            const hasGridMode = document.body.classList.contains('grid-mode');
            log(`ÁèæÂú®„ÅÆ„Ç∞„É™„ÉÉ„Éâ„É¢„Éº„Éâ: ${hasGridMode ? 'ON' : 'OFF'}`);
            
            document.body.classList.toggle('grid-mode');
            const btn = document.querySelector('.grid-toggle');
            
            if (document.body.classList.contains('grid-mode')) {
                btn.textContent = '‚ñ° „Ç∞„É™„ÉÉ„ÉâOFF';
                btn.style.background = '#dc3545';
                log('‚äû „Ç∞„É™„ÉÉ„ÉâË°®Á§∫„É¢„Éº„Éâ: ON „Å´Âàá„ÇäÊõø„Åà');
                createGridOverlay();
            } else {
                btn.textContent = '‚äû „Ç∞„É™„ÉÉ„ÉâË°®Á§∫';
                btn.style.background = '#28a745';
                log('‚ñ° „Ç∞„É™„ÉÉ„ÉâË°®Á§∫„É¢„Éº„Éâ: OFF „Å´Âàá„ÇäÊõø„Åà');
                removeGridOverlay();
            }
        };
        
        // „Ç∞„É™„ÉÉ„Éâ„Ç™„Éº„Éê„Éº„É¨„Ç§‰ΩúÊàêÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
        function createGridOverlay() {
            // Êó¢Â≠ò„ÅÆ„Ç™„Éº„Éê„Éº„É¨„Ç§„ÇíÂâäÈô§
            removeGridOverlay();
            
            const overlay = document.createElement('div');
            overlay.className = 'grid-overlay';
            overlay.id = 'gridOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none !important;
                z-index: 10000000;
            `;
            
            // „Ç∞„É™„ÉÉ„ÉâË®≠ÂÆö
            const gridSize = 30; // „Éî„ÇØ„Çª„É´Âçò‰Ωç
            const maxCols = Math.ceil(window.innerWidth / gridSize);
            const maxRows = Math.min(100, Math.ceil(window.innerHeight / gridSize)); // ÊúÄÂ§ß100Ë°å
            
            // ExcelÈ¢®„ÅÆÂàó„É©„Éô„É´ÁîüÊàêÈñ¢Êï∞
            function getColumnLabel(index) {
                let label = '';
                let num = index;
                while (num >= 0) {
                    label = String.fromCharCode(65 + (num % 26)) + label;
                    num = Math.floor(num / 26) - 1;
                    if (num < 0) break;
                }
                return label;
            }
            
            // „Ç∞„É™„ÉÉ„ÉâÁ∑ö„ÇíËøΩÂä†
            for (let i = 0; i <= maxCols; i++) {
                // ÂûÇÁõ¥Á∑ö
                const vLine = document.createElement('div');
                vLine.style.cssText = `
                    position: absolute;
                    left: ${i * gridSize}px;
                    top: 0;
                    width: 1px;
                    height: 100%;
                    background: rgba(40,167,69,0.2);
                    pointer-events: none;
                    z-index: 999998;
                `;
                overlay.appendChild(vLine);
            }
            
            for (let i = 0; i <= maxRows; i++) {
                // Ê∞¥Âπ≥Á∑ö
                const hLine = document.createElement('div');
                hLine.style.cssText = `
                    position: absolute;
                    left: 0;
                    top: ${i * gridSize}px;
                    width: 100%;
                    height: 1px;
                    background: rgba(40,167,69,0.2);
                    pointer-events: none;
                    z-index: 999998;
                `;
                overlay.appendChild(hLine);
            }
            
            // „É©„Éô„É´„ÇíËøΩÂä†Ôºà„Åô„Åπ„Å¶„ÅÆ„Ç∞„É™„ÉÉ„Éâ„Å´Ë°®Á§∫Ôºâ
            for (let row = 0; row <= maxRows; row++) {
                for (let col = 0; col <= maxCols; col++) {
                    if (row === 0 || col === 0) {
                        const label = document.createElement('div');
                        label.className = 'grid-number';
                        label.style.cssText = `
                            position: absolute;
                            font-size: 10px;
                            color: rgba(40,167,69,0.9);
                            font-weight: bold;
                            background: rgba(255,255,255,0.95);
                            padding: 1px 3px;
                            border-radius: 2px;
                            pointer-events: none;
                            z-index: 999999;
                        `;
                        
                        if (row === 0 && col > 0) {
                            // ‰∏äÈÉ®„Å´Âàó„É©„Éô„É´ÔºàA,B,C...Z,AA,AB...Ôºâ
                            label.textContent = getColumnLabel(col - 1);
                            label.style.left = `${col * gridSize - 10}px`;
                            label.style.top = '2px';
                            overlay.appendChild(label);
                        } else if (col === 0 && row > 0) {
                            // Â∑¶ÂÅ¥„Å´Ë°åÁï™Âè∑Ôºà1,2,3...100Ôºâ
                            label.textContent = row.toString();
                            label.style.left = '2px';
                            label.style.top = `${row * gridSize - 10}px`;
                            overlay.appendChild(label);
                        }
                    }
                }
            }
            
            document.body.appendChild(overlay);
        }
        
        function removeGridOverlay() {
            const overlay = document.getElementById('gridOverlay');
            if (overlay) overlay.remove();
        }
        
        // „Ç∞„É™„ÉÉ„Éâ‰ΩçÁΩÆË™øÊï¥„Éò„É´„Éë„ÉºÈñ¢Êï∞
        window.adjustGridPosition = (selector, gridCode, adjustment) => {
            // gridCode‰æã: "B4-C" (ÂàóB, Ë°å4-CÁØÑÂõ≤)
            // adjustment‰æã: 0.5 (0.5„Ç∞„É™„ÉÉ„ÉâÂàÜÁü≠„Åè/Â∞è„Åï„Åè)
            const element = document.querySelector(selector);
            if (!element) {
                log(`‚ùå Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ${selector}`);
                return;
            }
            
            // „Ç∞„É™„ÉÉ„Éâ„Ç≥„Éº„Éâ„ÅÆËß£Êûê (‰æã: "B4" ‚Üí ÂàóB(2), Ë°å4)
            const match = gridCode.match(/^([A-T])(\d+)(?:-([A-T])?(\d+)?)?$/);
            if (!match) {
                log(`‚ùå ÁÑ°Âäπ„Å™„Ç∞„É™„ÉÉ„Éâ„Ç≥„Éº„Éâ: ${gridCode}`);
                return;
            }
            
            const startCol = match[1].charCodeAt(0) - 'A'.charCodeAt(0) + 1;
            const startRow = parseInt(match[2]);
            const endCol = match[3] ? match[3].charCodeAt(0) - 'A'.charCodeAt(0) + 1 : startCol;
            const endRow = match[4] ? parseInt(match[4]) : startRow;
            
            // „Ç∞„É™„ÉÉ„ÉâÂçò‰Ωç„Çí„Éî„ÇØ„Çª„É´„Å´Â§âÊèõÔºà30px„Åå1„Ç∞„É™„ÉÉ„ÉâÔºâ
            const gridWidth = 30;
            const gridHeight = 30;
            
            // ÁèæÂú®„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂèñÂæó
            const currentStyle = window.getComputedStyle(element);
            const currentWidth = parseFloat(currentStyle.width);
            const currentHeight = parseFloat(currentStyle.height);
            
            // Ë™øÊï¥„ÇíÈÅ©Áî®
            if (adjustment < 0) {
                // „Éû„Ç§„Éä„ÇπË™øÊï¥ = Áü≠„Åè/Â∞è„Åï„Åè
                element.style.width = `${currentWidth + (adjustment * gridWidth)}px`;
                element.style.height = `${currentHeight + (adjustment * gridHeight)}px`;
            } else {
                // „Éó„É©„ÇπË™øÊï¥ = Èï∑„Åè/Â§ß„Åç„Åè
                element.style.width = `${currentWidth + (adjustment * gridWidth)}px`;
                element.style.height = `${currentHeight + (adjustment * gridHeight)}px`;
            }
            
            log(`‚úÖ „Ç∞„É™„ÉÉ„ÉâË™øÊï¥ÂÆå‰∫Ü: ${selector} @ ${gridCode} (${adjustment > 0 ? '+' : ''}${adjustment}„Ç∞„É™„ÉÉ„Éâ)`);
        };
        
        // „Ç∞„É™„ÉÉ„Éâ‰ΩçÁΩÆÂèñÂæó„Éò„É´„Éë„ÉºÈñ¢Êï∞
        window.getGridPosition = (selector) => {
            const element = document.querySelector(selector);
            if (!element) {
                log(`‚ùå Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ${selector}`);
                return null;
            }
            
            const rect = element.getBoundingClientRect();
            const gridCol = Math.floor(rect.left / 30);
            const gridRow = Math.floor(rect.top / 30);
            
            const colLetter = String.fromCharCode('A'.charCodeAt(0) + gridCol);
            const position = `${colLetter}${gridRow + 1}`;
            
            log(`üìç „Ç∞„É™„ÉÉ„Éâ‰ΩçÁΩÆ: ${selector} ‚Üí ${position}`);
            return position;
        };
        
        // „Ç∞„É™„ÉÉ„ÉâË™øÊï¥„ÉÜ„Çπ„ÉàÈñ¢Êï∞
        window.testGridAdjust = () => {
            log('üìê === „Ç∞„É™„ÉÉ„ÉâË™øÊï¥„ÉÜ„Çπ„ÉàÈñãÂßã ===');
            
            // „Éë„Éç„É´„É¨„Éô„É´„ÅÆË¶ÅÁ¥†„ÇíË¶ã„Å§„Åë„Å¶Ë™øÊï¥
            const testElement = document.querySelector('[data-grid="B3"]');
            if (testElement) {
                log('üéØ B3„Éë„Éç„É´Ë¶ÅÁ¥†„ÇíÁô∫Ë¶ã');
                
                // ÂÖÉ„ÅÆ„Çµ„Ç§„Ç∫„ÇíË®òÈå≤
                const originalWidth = testElement.offsetWidth;
                const originalHeight = testElement.offsetHeight;
                log(`üìè ÂÖÉ„ÅÆ„Çµ„Ç§„Ç∫: ${originalWidth}x${originalHeight}px`);
                
                // 0.5„Ç∞„É™„ÉÉ„ÉâÂàÜË™øÊï¥
                adjustGridPosition('[data-grid="B3"]', 'B3', -0.5);
                
                // Êñ∞„Åó„ÅÑ„Çµ„Ç§„Ç∫„ÇíÁ¢∫Ë™ç
                const newWidth = testElement.offsetWidth;
                const newHeight = testElement.offsetHeight;
                log(`üìè Êñ∞„Åó„ÅÑ„Çµ„Ç§„Ç∫: ${newWidth}x${newHeight}px`);
                log(`üìä Â§âÂåñÈáè: ÂπÖ${newWidth - originalWidth}px, È´ò„Åï${newHeight - originalHeight}px`);
                
                // 3ÁßíÂæå„Å´ÂÖÉ„Å´Êàª„Åô
                setTimeout(() => {
                    adjustGridPosition('[data-grid="B3"]', 'B3', 0.5);
                    log('üîÑ ÂÖÉ„ÅÆ„Çµ„Ç§„Ç∫„Å´Âæ©ÂÖÉ„Åó„Åæ„Åó„Åü');
                }, 3000);
                
                log('‚è±Ô∏è 3ÁßíÂæå„Å´Ëá™ÂãïÁöÑ„Å´ÂÖÉ„ÅÆ„Çµ„Ç§„Ç∫„Å´Êàª„Çä„Åæ„Åô');
            } else {
                log('‚ùå B3„Éë„Éç„É´Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                log('üí° „Ç∞„É™„ÉÉ„ÉâË°®Á§∫„ÇíON„Å´„Åó„Å¶„ÄÅË¶ÅÁ¥†„ÅÆ‰ΩçÁΩÆ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
            
            log('üìê === „ÉÜ„Çπ„ÉàÁµÇ‰∫Ü ===');
        };
        
        log('üöÄ 4Êäû„ÇØ„Ç§„Ç∫„Ç¢„Éó„É™ v1.0 Ëµ∑ÂãïÂÆå‰∫Ü');
        log('üîê Ë™çË®º„Ç∑„Çπ„ÉÜ„É†Ê∫ñÂÇôÂÆå‰∫Ü');
        log('üß† „ÇØ„Ç§„Ç∫„Ç∑„Çπ„ÉÜ„É†Ê∫ñÂÇôÂÆå‰∫Ü');
        
        // „Éó„É≠„Éà„Ç≥„É´„ÉÅ„Çß„ÉÉ„ÇØÔºàËá™ÂãïË®∫Êñ≠Ôºâ
        if (window.location.protocol === 'file:') {
            log('‚ö†Ô∏è file://„Éó„É≠„Éà„Ç≥„É´Ê§úÂá∫ - Google„É≠„Ç∞„Ç§„É≥„Å´„ÅØ HTTP„Çµ„Éº„Éê„Éº„ÅåÂøÖË¶Å„Åß„Åô');
            log('üí° Ëß£Ê±∫ÊñπÊ≥ï: python -m http.server 8000 „Åæ„Åü„ÅØ chrome://flagsË®≠ÂÆö');
        }
    </script>
</body>
</html>
